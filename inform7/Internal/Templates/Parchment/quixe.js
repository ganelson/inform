"use strict";(()=>{var os=Object.create;var bf=Object.defineProperty;var ds=Object.getOwnPropertyDescriptor;var _s=Object.getOwnPropertyNames;var vs=Object.getPrototypeOf,ms=Object.prototype.hasOwnProperty;var Ur=(u,D)=>()=>(D||u((D={exports:{}}).exports,D),D.exports);var ws=(u,D,pe,ne)=>{if(D&&typeof D=="object"||typeof D=="function")for(let be of _s(D))!ms.call(u,be)&&be!==pe&&bf(u,be,{get:()=>D[be],enumerable:!(ne=ds(D,be))||ne.enumerable});return u};var Or=(u,D,pe)=>(pe=u!=null?os(vs(u)):{},ws(D||!u||!u.__esModule?bf(pe,"default",{value:u,enumerable:!0}):pe,u));var yf=Ur(Pr=>{"use strict";var kf=function(){var u={};function D(e,r){u.GiDispa=r.GiDispa,u.GiLoad=r.GiLoad,u.Glk=r.io,J=e;var f=J.slice(0,64),s,l;for(s=0;s<f.length;s++)l=f[s].toString(16),l.length<2&&(l="0"+l),f[s]=l;He=f.join(""),r&&(ef=r.log_execution_time,rf=r.rethrow_exceptions,ff=r.do_vm_autosave,qr=r.clear_vm_autosave),r&&r.debug_info_chunk&&ns()}function pe(){return J!=null}function ne(e){switch(e){case"GiDispa":return u.GiDispa;case"GiLoad":return u.GiLoad;case"Glk":return u.Glk;case"GlkOte":return u.Glk.getlibrary("GlkOte");case"Dialog":return u.Glk.getlibrary("Dialog")}return null}function be(){if(u.vm_started){u.Glk.fatal_error("Quixe was inited twice!");return}try{x(),w(),If(),mf()}catch(e){throw e.stack&&O(`JS stack dump A:
`+e.stack),se(),u.Glk.fatal_error("Quixe init: "+c(e)),e}}function _(e){try{u.done_executing=u.vm_stopped,mf()}catch(r){if(r.stack&&O(`JS stack dump B:
`+r.stack),se(),u.Glk.fatal_error("Quixe run: "+c(r)),rf)throw r}}function c(e){if(typeof e=="string")return e;var r=e.toString();return e.message&&(r=r+" "+e.message),e.fileName&&(r=r+" "+e.fileName),e.lineNumber&&(r=r+" line:"+e.lineNumber),e.name&&(r=r+" "+e.name),e.number&&(r=r+" "+e.number),r}function O(e){window.console&&console.log?console.log(e):window.opera&&opera.postError&&opera.postError(e)}function ve(e,r){var f,s;if(jQuery.type(e)==="array"){r&&r--;var l=jQuery.map(e,function(t,h){return ve(t,r)});return"["+l.join(",")+"]"}if(jQuery.type(e)!=="object")return""+e;s=[];for(f in e){var i=e[f];r&&jQuery.type(i)==="object"&&(i=ve(i,r-1)),s.push(f+":"+i)}return"{ "+s.join(", ")+" }"}function se(){if(!(!W||!W.length)){var e,r,f,s,l=[];for(e=0;e<W.length;e++){if(s=W[e],!s.vmfunc.funcaddr){l.push("(anonymous)");continue}r="0x"+s.vmfunc.funcaddr.toString(16),f=Ie.functionmap[s.vmfunc.funcaddr],f&&(r=r+(' "'+f.name+'"')),l.push(r)}O("VM stack dump: "+l.join(", "))}}Math.imul===void 0&&(O("Polyfilling Math.imul()."),Math.imul=function(e,r){var f=e>>>16&65535,s=e&65535,l=r>>>16&65535,i=r&65535;return s*i+(f*i+s*l<<16>>>0)|0});var Z=Array(256),de=Array(256);function x(){var e,r;for(e=0;e<256;e++)r=e.toString(16),e<16&&(r="0"+r),Z[e]=r;for(e=0;e<256;e++)e>=32&&e<127?e==34||e==39||e==92?r="\\"+String.fromCharCode(e):r=String.fromCharCode(e):e==10?r="\\n":r="\\x"+Z[e],de[e]=r}function o(e,r){return e[r]*16777216+e[r+1]*65536+e[r+2]*256+e[r+3]}function A(e,r){return e[r]*256+e[r+1]}function H(e,r){return e[r]}function n(e){return y[e]}function v(e){return y[e]*256+y[e+1]}function g(e){return y[e]*16777216+y[e+1]*65536+y[e+2]*256+y[e+3]}function ce(e,r){return y.slice(e,e+r)}function Ae(e,r){y[e]=r&255}function S(e,r){y[e]=r>>8&255,y[e+1]=r&255}function q(e,r){y[e]=r>>24&255,y[e+1]=r>>16&255,y[e+2]=r>>8&255,y[e+3]=r&255}u.Mem1=n,u.Mem2=v,u.Mem4=g,u.MemSlice=ce,u.MemW1=Ae,u.MemW2=S,u.MemW4=q;function le(e,r){for(var f=0;f<r.length;f++)e.push(r.charCodeAt(f))}function Y(e,r){e.push(r>>24&255),e.push(r>>16&255),e.push(r>>8&255),e.push(r&255)}function Qe(e,r){e.push(r>>8&255),e.push(r&255)}function Be(e,r){e.push(r&255)}function ke(e,r,f){e[r]=f>>24&255,e[r+1]=f>>16&255,e[r+2]=f>>8&255,e[r+3]=f&255}function Te(e,r,f){return String.fromCharCode.apply(this,e.slice(r,r+f))}function Ge(e){return y[e]>=128?"0xffffff"+Z[y[e]]:"0x"+Z[y[e]]}function ze(e){return y[e]>=128?"0xffff"+Z[y[e]]+Z[y[e+1]]:y[e]?"0x"+Z[y[e]]+Z[y[e+1]]:"0x"+Z[y[e+1]]}function ie(e){return y[e]?"0x"+Z[y[e]]+Z[y[e+1]]+Z[y[e+2]]+Z[y[e+3]]:y[e+1]?"0x"+Z[y[e+1]]+Z[y[e+2]]+Z[y[e+3]]:y[e+2]?"0x"+Z[y[e+2]]+Z[y[e+3]]:"0x"+Z[y[e+3]]}function ye(e){return e==4294967295?u.frame.valstack.pop()&255:n(e)}function me(e,r){e==4294967295?u.frame.valstack.push(r&255):Ae(e,r)}function kr(e){return e==4294967295?u.frame.valstack.pop():g(e)}function Ue(e,r){e==4294967295?u.frame.valstack.push(r):q(e,r)}function Fe(e,r){return e==4294967295?u.frame.valstack.pop():g(e+4*r)}function Oe(e,r,f){e==4294967295?u.frame.valstack.push(f):q(e+4*r,f)}function yr(e){u.resumevalue=e}function xe(e){return e<65536?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(e&1023)))}function Fr(e){if(e<256)return de[e];if(e<65536){for(e=e.toString(16);e.length<4;)e="0"+e;return"\\u"+e}else{var r;return e-=65536,r=55296+(e>>10),e=56320+(e&1023),"\\u"+r.toString(16)+"\\u"+e.toString(16)}}function Pe(e){return Fr(e.charCodeAt(0))}var we=/[^a-zA-Z0-9 .,;:?!=_+()-]/g;function nr(e){return e=e.replace(we,Pe),'"'+e+'"'}function p(e){var r,f;if(arguments.length>1){for(e+=" (",r=1;r<arguments.length;r++)f=arguments[r],typeof f=="number"?f=f.toString(16):f=""+f,r!=1&&(e+=" "),e+=f;e+=")"}throw O(e),new Error(e)}u.fatal_error=p;function tr(e,r,f,s){var l;return r===void 0&&(r="_func"),f===void 0?l=new Function("self",e):s===void 0?l=new Function("self",f,e):l=new Function("self",f,s,e),l}function hr(e,r,f,s){e?(this.funcaddr=e,this.startpc=r,this.functype=n(e)):(this.funcaddr=null,this.startpc=null,this.functype=null),this.pathaddrs={},this[0]={},this[1]={},this[2]={},this.locallen=null,this.localsformat=f,this.rawformat=s,this.localsindex=[];var l,i,t=0;for(l=0;l<this.localsformat.length;l++){var h=this.localsformat[l];if(h.size==4)for(;t&3;)t++;else if(h.size==2)for(;t&1;)t++;for(i=0;i<h.count;i++)this.localsindex.push({size:h.size,pos:t}),t+=h.size}for(;t&3;)t++;this.locallen=t}function qe(e){var r;for(this.vmfunc=e,this.depth=null,this.framestart=null,this.framelen=null,this.valstack=[],this.localspos=null,this.localsindex=e.localsindex,this.locals=[],r=0;r<this.localsindex.length;r++){var f=this.localsindex[r];this.locals[f.pos]=0}this.framelen=8+e.rawformat.length+e.locallen}function Ze(e){var r=new qe(e.vmfunc);return r.depth=e.depth,r.framestart=e.framestart,r.framelen=e.framelen,r.valstack=e.valstack.slice(0),r.localspos=e.localspos,r.locals=e.locals.slice(0),r.framelen=e.framelen,r}function cr(e,r){Y(r,e.framelen);var f=e.vmfunc.rawformat;Y(r,8+f.length);for(var s=0;s<f.length;s++)r.push(f[s]);for(var s=0;s<e.vmfunc.localsindex.length;s++){var l=e.vmfunc.localsindex[s];if(l.size==4){for(;r.length&3;)r.push(0);Y(r,e.locals[l.pos])}else if(l.size==2){for(;r.length&1;)r.push(0);Qe(r,e.locals[l.pos])}else Be(r,e.locals[l.pos])}for(;r.length&3;)r.push(0);for(var s=0;s<e.valstack.length;s++)Y(r,e.valstack[s])}function or(e){var r=o(e,e.length-4);if(r<0||r>=e.length){O("Bad frameptr in serialized stack frame");return}e=e.splice(r,e.length);for(var f=o(e,0),s=o(e,4),l=e.slice(8,s),i=[],t=8;;){var h=H(e,t);t++;var d=H(e,t);if(t++,h==0)break;h!=1&&h!=2&&h!=4&&p("Invalid local variable size in function header.",h),i.push({size:h,count:d})}var a=new hr(null,null,i,l),F=new qe(a);F.framestart=r;for(var j=0;j<F.vmfunc.localsindex.length;j++){var E=F.vmfunc.localsindex[j];E.size==4?F.locals[E.pos]=o(e,s+E.pos):E.size==2?F.locals[E.pos]=A(e,s+E.pos):F.locals[E.pos]=H(e,s+E.pos)}for(var Q=f;Q<e.length;Q+=4)F.valstack.push(o(e,Q));return F}function xr(e,r){e==0&&p("Tried to create a VMTextEnv for address zero."),this.addr=e,this.cacheable=r!==void 0,this.decoding_tree=r,this.vmstring_tables=[],this.cacheable&&(this.vmstring_tables[0]={},this.vmstring_tables[1]={},this.vmstring_tables[2]={})}var m=null;function w(){function e(Rr,gf){this.argsize=gf||4,this.numops=Rr.length;for(var pf=[],Ir=0;Ir<Rr.length;Ir++)pf.push(Rr.charAt(Ir));this.formlist=pf}var r=new e(""),f=new e("L"),s=new e("LL"),l=new e("LLL"),i=new e("LLLL"),t=new e("LLLLL"),h=new e("LLLLLLL"),d=new e("LS"),a=new e("LLS"),F=new e("LLLLLLS"),j=new e("LLLLLLLS"),E=new e("LSS"),Q=new e("LLSS"),X=new e("LLLLSS"),T=new e("LC"),fe=new e("LLC"),De=new e("LLLC"),Ce=new e("LLLLC"),ge=new e("ES"),K=new e("LES"),ae=new e("EES"),Se=new e("F"),Ke=new e("LF"),Vr=new e("LLF"),wf=new e("EF"),br=new e("EF",1),er=new e("EF",2),$e=new e("S"),ts=new e("SS"),hs=new e("CL"),cs=new e("C");m={0:r,16:ae,17:K,18:a,19:a,20:a,21:ge,24:ae,25:ae,26:ae,27:ge,28:a,29:a,30:a,32:f,34:s,35:s,36:l,37:l,38:l,39:l,40:l,41:l,42:l,43:l,44:l,45:l,48:fe,49:f,50:hs,51:s,52:s,64:wf,65:er,66:br,68:d,69:d,72:a,73:a,74:a,75:a,76:l,77:l,78:l,79:l,80:Se,81:Ke,82:r,83:s,84:f,112:f,113:f,114:f,115:f,256:a,257:f,258:$e,259:d,260:f,272:d,273:f,288:r,289:$e,290:r,291:T,292:Ke,293:cs,294:Se,295:s,296:$e,297:r,304:Vr,320:$e,321:f,328:ts,329:s,336:j,337:j,338:F,352:T,353:fe,354:De,355:Ce,368:s,369:l,376:d,377:f,384:s,385:s,400:d,401:d,402:d,408:d,409:d,416:a,417:a,418:a,419:a,420:Q,424:d,425:d,426:d,427:a,432:d,433:d,434:d,435:d,436:d,437:d,438:a,448:i,449:i,450:l,451:l,452:l,453:l,456:s,457:s,512:E,513:a,514:a,515:E,516:a,520:Q,521:Q,528:X,529:X,530:X,531:X,532:X,533:X,536:Q,537:Q,538:Q,539:X,544:Q,545:Q,546:Q,547:Q,548:Q,549:Q,550:X,560:h,561:h,562:t,563:t,564:t,565:t,568:l,569:l}}u.funcop_cache={};function M(e){if(e.mode==0)return"null";var r="m"+e.mode;if(e.argsize!=null&&(r=r+"s"+e.argsize),e.addr!=null&&(r=r+"a"+e.addr),u.funcop_cache.key)return"self.funcop_cache."+r;var f={key:r,mode:e.mode,argsize:e.argsize,addr:e.addr};return u.funcop_cache[r]=f,"self.funcop_cache."+r}function B(e,r,f){var s;switch(r.mode){case 8:if(r.argsize==4){var l=f[0];if(l==="0"){e.offstack.push(f),e.code.push("// push to offstack: "+f);return}if(l==="_"){C(e,f),e.code.push("// re-push to offstack: "+f);return}}s=ee(e,!0),e.offstack.push(s),r.argsize==4?e.code.push(s+"=("+f+");"):r.argsize==2?e.code.push(s+"=0xffff&("+f+");"):e.code.push(s+"=0xff&("+f+");");return;case 0:e.code.push("("+f+");");return;case 11:if(r.argsize==4){var l=f[0];if(l==="0"){te(e,r.addr,f,!1),e.code.push("// store to offloc["+r.addr+"]: "+f);return}if(l==="_"){te(e,r.addr,f,!0),e.code.push("// re-store to offloc["+r.addr+"]: "+f);return}}te(e,r.addr,void 0),r.argsize==4?e.code.push("self.frame.locals["+r.addr+"]=("+f+");"):r.argsize==2?e.code.push("self.frame.locals["+r.addr+"]=(0xffff &"+f+");"):e.code.push("self.frame.locals["+r.addr+"]=(0xff &"+f+");");return;case 15:r.argsize==4?e.code.push("self.MemW4("+r.addr+","+f+");"):r.argsize==2?e.code.push("self.MemW2("+r.addr+","+f+");"):e.code.push("self.MemW1("+r.addr+","+f+");");return;default:p("Unknown addressing mode in store func operand.")}}function P(e,r,f){f===void 0&&(f=e.cp),e.code.push("self.frame.valstack.push("+r+","+f+",self.frame.framestart);")}function V(e){e.code.push("if (!substring) { substring=true;"),e.code.push("self.frame.valstack.push(0x11,0,nextcp,self.frame.framestart);"),e.code.push("}")}function I(e,r){var f;if(e.code.push("// unload offstate: "+e.offstack.length+" stack"+(e.offloc.length?", plus locs":"")+(r?" (conditional)":"")),e.offstack.length&&e.code.push("self.frame.valstack.push("+e.offstack.join(",")+");"),e.offloc.length)for(f=0;f<e.offloc.length;f++)e.offloc[f]!==void 0&&e.offlocdirty[f]&&e.code.push("self.frame.locals["+f+"]="+e.offloc[f]+";");if(!r){var s;for(f=0;f<e.offloc.length;f++)s=e.offloc[f],s!==void 0&&e.holduse[s]!==void 0&&(e.holduse[s]=!1);for(e.offloc.length=0,e.offlocdirty.length=0;e.offstack.length;)s=e.offstack.pop(),e.holduse[s]!==void 0&&(e.holduse[s]=!1)}}function ue(e){if(e.buffer.length!=0){var r=e.buffer.join("");e.buffer.length=0,r.length!=0&&e.code.push("self.Glk.glk_put_jstring("+nr(r)+");")}}function L(e,r,f){var s;if(G(r))return s=Number(r),s&2147483648?""+(s-4294967296):r;if(s="("+r+"&0xffffffff)",f){var l=ee(e);return e.code.push(l+"="+s+";"),l}else return s}function k(e,r,f){var s;if(G(r))return s=Number(r),s==2147483648?"-0":""+mr(s);if(s="self.decode_float("+r+")",f){var l=ee(e);return e.code.push(l+"="+s+";"),l}else return s}function b(e,r,f,s){var l,i,t;if(G(r)&&G(f))return i=Number(r),t=Number(f),i==2147483648&&t==0?"-0":""+wr(i,t);if(l="self.decode_double("+r+","+f+")",s){var h=ee(e);return e.code.push(h+"="+l+";"),h}else return l}function z(e,r,f){if(G(r)){var s=Number(r);if(s==0||s==1)f?(e.code.push("// quashing offstack for unconditional return: "+e.offstack.length),e.offstack.length=0,e.offloc.length=0,e.offlocdirty.length=0):e.code.push("// ignoring offstack for conditional return: "+e.offstack.length),e.code.push("if (self.leave_function()) return self.VMStopped;"),e.code.push("self.pop_callstub("+s+");");else{I(e,!f);var l=e.cp+s-2>>>0;e.code.push("self.pc = "+l+";"),e.vmfunc.pathaddrs[l]=!0}}else I(e,!f),e.code.push("if (("+r+")==0 || ("+r+")==1) {"),e.code.push("if (self.leave_function()) return self.VMStopped;"),e.code.push("self.pop_callstub("+r+");"),e.code.push("}"),e.code.push("else {"),e.code.push("self.pc = ("+e.cp+"+("+r+")-2) >>>0;"),e.code.push("}");e.code.push("return;")}var rr={0:function(e,r){},16:function(e,r){e.code.push(r[2]+"(("+r[0]+")+("+r[1]+")) >>>0);")},17:function(e,r){e.code.push(r[2]+"(("+r[0]+")-("+r[1]+")) >>>0);")},18:function(e,r){var f=L(e,r[0]),s=L(e,r[1]);e.code.push(r[2]+"(Math.imul(("+f+"),("+s+"))) >>>0);")},19:function(e,r){var f=L(e,r[0]),s=L(e,r[1]),l=ee(e);e.code.push(l+"=(("+f+")/("+s+"));"),e.code.push("if (!isFinite("+l+")) self.fatal_error('Division by zero.');"),e.code.push(r[2]+"("+l+">=0)?Math.floor("+l+"):(-Math.floor(-"+l+") >>>0));")},20:function(e,r){var f=L(e,r[0]),s=L(e,r[1]),l=ee(e);e.code.push(l+"=(("+f+")%("+s+"));"),e.code.push("if (!isFinite("+l+")) self.fatal_error('Modulo division by zero.');"),e.code.push(r[2]+l+" >>>0);")},21:function(e,r){e.code.push(r[1]+"(-("+r[0]+")) >>>0);")},24:function(e,r){e.code.push(r[2]+"(("+r[0]+")&("+r[1]+")) >>>0);")},25:function(e,r){e.code.push(r[2]+"(("+r[0]+")|("+r[1]+")) >>>0);")},26:function(e,r){e.code.push(r[2]+"(("+r[0]+")^("+r[1]+")) >>>0);")},27:function(e,r){e.code.push(r[1]+"(~("+r[0]+")) >>>0);")},28:function(e,r){if(G(r[1])){var f=Number(r[1]);f<32?e.code.push(r[2]+"(("+r[0]+")<<"+f+") >>>0);"):e.code.push(r[2]+"0);")}else e.code.push(r[2]+"("+r[1]+"<32) ? (("+r[0]+"<<"+r[1]+") >>>0) : 0);")},29:function(e,r){if(G(r[1])){var f=Number(r[1]);f<32?e.code.push(r[2]+"(("+r[0]+")>>"+f+") >>>0);"):e.code.push(r[2]+"(("+r[0]+")&0x80000000) ? 0xffffffff : 0);")}else e.code.push("if ("+r[0]+" & 0x80000000) {"),e.code.push(r[2]+"("+r[1]+"<32) ? (("+r[0]+">>"+r[1]+") >>>0) : 0xffffffff);"),e.code.push("} else {"),e.code.push(r[2]+"("+r[1]+"<32) ? (("+r[0]+">>"+r[1]+") >>>0) : 0);"),e.code.push("}")},30:function(e,r){if(G(r[1])){var f=Number(r[1]);f<32?e.code.push(r[2]+"("+r[0]+")>>>"+f+");"):e.code.push(r[2]+"0);")}else e.code.push(r[2]+"("+r[1]+"<32) ? ("+r[0]+">>>"+r[1]+") : 0);")},32:function(e,r){z(e,r[0],!0),e.path_ends=!0},260:function(e,r){if(G(r[0])){var f=Number(r[0]);e.code.push("self.pc = "+f+";"),e.vmfunc.pathaddrs[f]=!0}else e.code.push("self.pc = "+r[0]+";");I(e),e.code.push("return;"),e.path_ends=!0},34:function(e,r){e.code.push("if (("+r[0]+")==0) {"),z(e,r[1]),e.code.push("}")},35:function(e,r){e.code.push("if (("+r[0]+")!=0) {"),z(e,r[1]),e.code.push("}")},36:function(e,r){e.code.push("if (("+r[0]+")==("+r[1]+")) {"),z(e,r[2]),e.code.push("}")},37:function(e,r){e.code.push("if (("+r[0]+")!=("+r[1]+")) {"),z(e,r[2]),e.code.push("}")},38:function(e,r){var f=L(e,r[0]),s=L(e,r[1]);e.code.push("if (("+f+")<("+s+")) {"),z(e,r[2]),e.code.push("}")},39:function(e,r){var f=L(e,r[0]),s=L(e,r[1]);e.code.push("if (("+f+")>=("+s+")) {"),z(e,r[2]),e.code.push("}")},40:function(e,r){var f=L(e,r[0]),s=L(e,r[1]);e.code.push("if (("+f+")>("+s+")) {"),z(e,r[2]),e.code.push("}")},41:function(e,r){var f=L(e,r[0]),s=L(e,r[1]);e.code.push("if (("+f+")<=("+s+")) {"),z(e,r[2]),e.code.push("}")},42:function(e,r){e.code.push("if (("+r[0]+")<("+r[1]+")) {"),z(e,r[2]),e.code.push("}")},43:function(e,r){e.code.push("if (("+r[0]+")>=("+r[1]+")) {"),z(e,r[2]),e.code.push("}")},44:function(e,r){e.code.push("if (("+r[0]+")>("+r[1]+")) {"),z(e,r[2]),e.code.push("}")},45:function(e,r){e.code.push("if (("+r[0]+")<=("+r[1]+")) {"),z(e,r[2]),e.code.push("}")},48:function(e,r){if(G(r[1])){var f,s=Number(r[1]);for(f=0;f<s;f++)if(e.offstack.length){var l=je(e);e.code.push("self.tempcallargs["+f+"]="+l+";")}else e.code.push("self.tempcallargs["+f+"]=self.frame.valstack.pop();");I(e)}else e.varsused.ix=!0,I(e),e.code.push("for (ix=0; ix<"+r[1]+"; ix++) { self.tempcallargs[ix]=self.frame.valstack.pop(); }");P(e,r[2]),e.code.push("self.enter_function("+r[0]+", "+r[1]+");"),e.code.push("return;"),e.path_ends=!0},52:function(e,r){if(G(r[1])){var f,s=Number(r[1]);for(f=0;f<s;f++)if(e.offstack.length){var l=je(e);e.code.push("self.tempcallargs["+f+"]="+l+";")}else e.code.push("self.tempcallargs["+f+"]=self.frame.valstack.pop();");I(e)}else e.varsused.ix=!0,I(e),e.code.push("for (ix=0; ix<"+r[1]+"; ix++) { self.tempcallargs[ix]=self.frame.valstack.pop(); }");e.code.push("if (self.leave_function()) return self.VMStopped;"),e.code.push("self.enter_function("+r[0]+", "+r[1]+");"),e.code.push("return;"),e.path_ends=!0},352:function(e,r){I(e),P(e,r[1]),e.code.push("self.enter_function("+r[0]+", 0);"),e.code.push("return;"),e.path_ends=!0},353:function(e,r){I(e),e.code.push("self.tempcallargs[0]=("+r[1]+");"),P(e,r[2]),e.code.push("self.enter_function("+r[0]+", 1);"),e.code.push("return;"),e.path_ends=!0},354:function(e,r){I(e),e.code.push("self.tempcallargs[0]=("+r[1]+");"),e.code.push("self.tempcallargs[1]=("+r[2]+");"),P(e,r[3]),e.code.push("self.enter_function("+r[0]+", 2);"),e.code.push("return;"),e.path_ends=!0},355:function(e,r){I(e),e.code.push("self.tempcallargs[0]=("+r[1]+");"),e.code.push("self.tempcallargs[1]=("+r[2]+");"),e.code.push("self.tempcallargs[2]=("+r[3]+");"),P(e,r[4]),e.code.push("self.enter_function("+r[0]+", 3);"),e.code.push("return;"),e.path_ends=!0},49:function(e,r){e.code.push("// quashing offstack for return: "+e.offstack.length),e.offstack.length=0,e.offloc.length=0,e.offlocdirty.length=0,e.code.push("if (self.leave_function()) return self.VMStopped;"),e.code.push("self.pop_callstub("+r[0]+");"),e.code.push("return;"),e.path_ends=!0},50:function(e,r){I(e),P(e,r[0]),e.code.push("self.store_operand("+r[0]+",self.frame.framestart+self.frame.framelen+4*self.frame.valstack.length);"),z(e,r[1],!0),e.path_ends=!0},51:function(e,r){e.code.push("// quashing offstack for throw: "+e.offstack.length),e.offstack.length=0,e.offloc.length=0,e.offlocdirty.length=0,e.code.push("self.pop_stack_to("+r[1]+");"),e.code.push("self.pop_callstub("+r[0]+");"),e.code.push("return;"),e.path_ends=!0},64:function(e,r){B(e,r[1],r[0])},65:function(e,r){B(e,r[1],r[0])},66:function(e,r){B(e,r[1],r[0])},68:function(e,r){var f;G(r[0])?(f=Number(r[0]),f=f&32768?(f|4294901760)>>>0:f&65535,e.code.push(r[1]+f+");")):e.code.push(r[1]+"("+r[0]+" & 0x8000) ? (("+r[0]+" | 0xffff0000) >>> 0) : ("+r[0]+" & 0xffff));")},69:function(e,r){var f;G(r[0])?(f=Number(r[0]),f=f&128?(f|4294967040)>>>0:f&255,e.code.push(r[1]+f+");")):e.code.push(r[1]+"("+r[0]+" & 0x80) ? (("+r[0]+" | 0xffffff00) >>> 0) : ("+r[0]+" & 0xff));")},72:function(e,r){var f,s;if(G(r[1]))if(G(r[0]))s=Number(r[0])+Number(r[1])*4,f="self.Mem4("+(s>>>0)+")";else{var s=Number(r[1])*4;s?f="self.Mem4(("+r[0]+"+"+s+") >>>0)":f="self.Mem4("+r[0]+")"}else f="self.Mem4(("+r[0]+"+4*"+r[1]+") >>>0)";e.code.push(r[2]+f+");")},73:function(e,r){var f,s;if(G(r[1]))if(G(r[0]))s=Number(r[0])+Number(r[1])*2,f="self.Mem2("+(s>>>0)+")";else{var s=Number(r[1])*2;s?f="self.Mem2(("+r[0]+"+"+s+") >>>0)":f="self.Mem2("+r[0]+")"}else f="self.Mem2(("+r[0]+"+2*"+r[1]+") >>>0)";e.code.push(r[2]+f+");")},74:function(e,r){var f,s;if(G(r[1]))if(G(r[0]))s=Number(r[0])+Number(r[1]),f="self.Mem1("+(s>>>0)+")";else{var s=Number(r[1]);s?f="self.Mem1(("+r[0]+"+"+s+") >>>0)":f="self.Mem1("+r[0]+")"}else f="self.Mem1(("+r[0]+"+"+r[1]+") >>>0)";e.code.push(r[2]+f+");")},76:function(e,r){var f,s;if(G(r[1]))if(G(r[0]))s=Number(r[0])+Number(r[1])*4,f=(s>>>0)+",";else{var s=Number(r[1])*4;s?f="("+r[0]+"+"+s+") >>>0,":f=r[0]+","}else f="("+r[0]+"+4*"+r[1]+") >>>0,";e.code.push("self.MemW4("+f+r[2]+");")},77:function(e,r){var f,s;if(G(r[1]))if(G(r[0]))s=Number(r[0])+Number(r[1])*2,f=(s>>>0)+",";else{var s=Number(r[1])*2;s?f="("+r[0]+"+"+s+") >>>0,":f=r[0]+","}else f="("+r[0]+"+2*"+r[1]+") >>>0,";e.code.push("self.MemW2("+f+r[2]+");")},78:function(e,r){var f,s;if(G(r[1]))if(G(r[0]))s=Number(r[0])+Number(r[1]),f=(s>>>0)+",";else{var s=Number(r[1]);s?f="("+r[0]+"+"+s+") >>>0,":f=r[0]+","}else f="("+r[0]+"+"+r[1]+") >>>0,";e.code.push("self.MemW1("+f+r[2]+");")},75:function(e,r){if(G(r[1])){var f,s,l;l=Number(r[1])&4294967295,f=l&7,G(r[0])?(s=Number(r[0]),l>=0?s+=l>>3:s-=1+(-1-l>>3)):l>=0?l<=7?s=r[0]:s=r[0]+"+"+(l>>3):s=r[0]+"-"+(1+(-1-l>>3)),e.code.push(r[2]+"(self.Mem1("+s+") & "+(1<<f)+")?1:0);")}else{e.varsused.bitx=!0,e.varsused.addrx=!0;var i=L(e,r[1],!0);e.code.push("bitx = "+i+"&7;"),e.code.push("if ("+i+">=0) addrx = "+r[0]+" + ("+i+">>3);"),e.code.push("else addrx = "+r[0]+" - (1+((-1-("+i+"))>>3));"),e.code.push(r[2]+"(self.Mem1(addrx) & (1<<bitx))?1:0);")}},79:function(e,r){var f,s,l,i;if(G(r[1]))i=Number(r[1])&4294967295,f=i&7,G(r[0])?(s=Number(r[0]),i>=0?s+=i>>3:s-=1+(-1-i>>3)):i>=0?i<=7?s=r[0]:s=r[0]+"+"+(i>>3):s=r[0]+"-"+(1+(-1-i>>3)),l=1<<f;else{e.varsused.bitx=!0,e.varsused.addrx=!0;var t=L(e,r[1],!0);e.code.push("bitx = "+t+"&7;"),e.code.push("if ("+t+">=0) addrx = "+r[0]+" + ("+t+">>3);"),e.code.push("else addrx = "+r[0]+" - (1+((-1-("+t+"))>>3));"),s="addrx",l="(1<<bitx)"}G(r[2])?Number(r[2])?e.code.push("self.MemW1("+s+", self.Mem1("+s+") | "+l+");"):e.code.push("self.MemW1("+s+", self.Mem1("+s+") & ~("+l+"));"):(e.code.push("if ("+r[2]+") self.MemW1("+s+", self.Mem1("+s+") | "+l+");"),e.code.push("else self.MemW1("+s+", self.Mem1("+s+") & ~("+l+"));"))},80:function(e,r){var f,s=e.offstack.length;s?f="self.frame.valstack.length+"+s:f="self.frame.valstack.length",B(e,r[0],f)},81:function(e,r){var f;if(G(r[0])){var s=Number(r[0]);s<e.offstack.length?f=e.offstack[e.offstack.length-(s+1)]:f="self.frame.valstack[self.frame.valstack.length-"+(s+1-e.offstack.length)+"]"}else I(e),f="self.frame.valstack[self.frame.valstack.length-("+r[0]+"+1)]";B(e,r[1],f)},82:function(e,r){var f,s;e.offstack.length<2&&fr(e,2),s=e.offstack.length,f=e.offstack[s-1],e.offstack[s-1]=e.offstack[s-2],e.offstack[s-2]=f},83:function(e,r){I(e),e.varsused.ix=!0,e.varsused.pos=!0,e.varsused.roll=!0,e.varsused.vals1=!0;var f=L(e,r[0],!0),s=L(e,r[1],!0);e.code.push("if ("+f+" > 0) {"),e.code.push("if ("+s+" > 0) {"),e.code.push("vals1 = "+s+" % "+f+";"),e.code.push("} else {"),e.code.push("vals1 = "+f+" - (-("+s+")) % "+f+";"),e.code.push("}"),e.code.push("if (vals1) {"),e.code.push("pos = self.frame.valstack.length - "+f+";"),e.code.push("roll = self.frame.valstack.slice(self.frame.valstack.length-vals1, self.frame.valstack.length).concat(self.frame.valstack.slice(pos, self.frame.valstack.length-vals1));"),e.code.push("for (ix=0; ix<"+f+"; ix++) { self.frame.valstack[pos+ix] = roll[ix]; }"),e.code.push("roll = undefined;"),e.code.push("}"),e.code.push("}")},84:function(e,r){if(I(e),G(r[0])){var f,s,l=Number(r[0]);for(f=0;f<l;f++)s=ee(e,!0),e.offstack.push(s),e.code.push(s+"=self.frame.valstack[self.frame.valstack.length-"+(l-f)+"];")}else e.varsused.ix=!0,e.varsused.jx=!0,e.code.push("jx = self.frame.valstack.length-("+r[0]+");"),e.code.push("for (ix=0; ix<"+r[0]+"; ix++) { self.frame.valstack.push(self.frame.valstack[jx+ix]); }")},256:function(e,r){var f="self.do_gestalt(("+r[0]+"),("+r[1]+"))";e.code.push(r[2]+f+");")},257:function(e,r){e.code.push("self.fatal_error('User debugtrap encountered.', "+r[0]+");")},258:function(e,r){e.code.push(r[0]+"self.endmem);")},259:function(e,r){e.code.push("self.change_memsize("+r[0]+",false);"),e.code.push(r[1]+"0);")},272:function(e,r){var f;if(G(r[0])){var s=Number(r[0])&4294967295;s==0?f="(Math.floor(self.random_func() * 0x10000) | (Math.floor(self.random_func() * 0x10000) << 16)) >>>0":s>0?f="Math.floor(self.random_func() * "+s+")":f="-Math.floor(self.random_func() * "+-s+")"}else{var l=L(e,r[0],!0),i=ee(e);f=i,e.code.push("if ("+l+" > 0)"),e.code.push(i+" = Math.floor(self.random_func() * "+l+");"),e.code.push("else if ("+l+" < 0)"),e.code.push(i+" = -Math.floor(self.random_func() * -"+l+");"),e.code.push("else"),e.code.push(i+" = (Math.floor(self.random_func() * 0x10000) | (Math.floor(self.random_func() * 0x10000) << 16)) >>>0;")}e.code.push(r[1]+f+");")},273:function(e,r){e.code.push("self.set_random("+r[0]+");")},288:function(e,r){e.code.push("// quashing offstack for quit: "+e.offstack.length),e.offstack.length=0,e.offloc.length=0,e.offlocdirty.length=0,e.code.push("return self.VMStopped;"),e.path_ends=!0},289:function(e,r){e.code.push(r[0]+"self.perform_verify());")},290:function(e,r){e.code.push("// quashing offstack for quit: "+e.offstack.length),e.offstack.length=0,e.offloc.length=0,e.offlocdirty.length=0,e.code.push("self.vm_restart();"),e.code.push("return;"),e.path_ends=!0},291:function(e,r){I(e),e.varsused.ix=!0,P(e,r[1]),e.code.push("ix = self.vm_save("+r[0]+");"),e.code.push("self.pop_callstub(ix ? 0 : 1);"),e.code.push("return;"),e.path_ends=!0},292:function(e,r){I(e),e.code.push("if (self.vm_restore("+r[0]+")) {"),e.code.push("self.pop_callstub((-1)>>>0);"),e.code.push("} else {"),B(e,r[1],"1"),I(e),e.code.push("self.pc = "+e.cp+";"),e.code.push("}"),e.code.push("return;"),e.path_ends=!0},293:function(e,r){I(e),P(e,r[0]),e.code.push("self.vm_saveundo();"),e.code.push("self.pop_callstub(0);"),e.code.push("return;"),e.path_ends=!0},294:function(e,r){I(e),e.code.push("if (self.vm_restoreundo()) {"),e.code.push("self.pop_callstub((-1)>>>0);"),e.code.push("} else {"),B(e,r[0],"1"),I(e),e.code.push("self.pc = "+e.cp+";"),e.code.push("}"),e.code.push("return;"),e.path_ends=!0},295:function(e,r){e.code.push("self.protectstart="+r[0]+";"),e.code.push("self.protectend=self.protectstart+("+r[1]+");"),e.code.push("if (self.protectstart==self.protectend) {"),e.code.push("  self.protectstart=0; self.protectend=0;"),e.code.push("}")},296:function(e,r){e.code.push(r[0]+"(self.vm_hasundo() ? 0 : 1));")},297:function(e,r){e.code.push("self.vm_discardundo();")},368:function(e,r){e.varsused.maddr=!0,e.varsused.mlen=!0,e.varsused.ix=!0,e.code.push("mlen="+r[0]+";"),e.code.push("maddr="+r[1]+";"),e.code.push("for (ix=0; ix<mlen; ix++, maddr++) self.MemW1(maddr, 0);")},369:function(e,r){e.varsused.msrc=!0,e.varsused.mdest=!0,e.varsused.mlen=!0,e.varsused.ix=!0,e.code.push("mlen="+r[0]+";"),e.code.push("msrc="+r[1]+";"),e.code.push("mdest="+r[2]+";"),e.code.push("if (mdest < msrc) {"),e.code.push("for (ix=0; ix<mlen; ix++, msrc++, mdest++) self.MemW1(mdest, self.Mem1(msrc));"),e.code.push("} else {"),e.code.push("msrc += (mlen-1); mdest += (mlen-1);"),e.code.push("for (ix=0; ix<mlen; ix++, msrc--, mdest--) self.MemW1(mdest, self.Mem1(msrc));"),e.code.push("}")},376:function(e,r){var f="self.heap_malloc("+r[0]+")";e.code.push(r[1]+f+");"),e.code.push("self.assert_heap_valid();")},377:function(e,r){e.code.push("self.heap_free("+r[0]+");"),e.code.push("self.assert_heap_valid();")},384:function(e,r){e.code.push("self.accel_funcnum_map["+r[1]+"] = "+r[0]+";"),e.code.push("self.accel_address_map["+r[1]+"] = self.accel_func_map["+r[0]+"];")},385:function(e,r){e.code.push("if ("+r[0]+" < 9) {"),e.code.push("  self.accel_params["+r[0]+"] = "+r[1]+";"),e.code.push("}")},336:function(e,r){var f="self.linear_search(("+r[0]+"),("+r[1]+"),("+r[2]+"),("+r[3]+"),("+r[4]+"),("+r[5]+"),("+r[6]+"))";e.code.push(r[7]+f+");")},337:function(e,r){var f="self.binary_search(("+r[0]+"),("+r[1]+"),("+r[2]+"),("+r[3]+"),("+r[4]+"),("+r[5]+"),("+r[6]+"))";e.code.push(r[7]+f+");")},338:function(e,r){var f="self.linked_search(("+r[0]+"),("+r[1]+"),("+r[2]+"),("+r[3]+"),("+r[4]+"),("+r[5]+"))";e.code.push(r[6]+f+");")},112:function(e,r){switch(e.curiosys){case 2:if(G(r[0])){var f=Number(r[0])&255;e.code.push("self.Glk.glk_put_char("+f+");")}else e.code.push("self.Glk.glk_put_char(("+r[0]+")&0xff);");break;case 1:I(e),e.code.push("self.tempcallargs[0]=(("+r[0]+")&0xff);"),P(e,"0,0"),e.code.push("self.enter_function(self.iosysrock, 1);"),e.code.push("return;"),e.path_ends=!0;break;case 0:e.code.push("// null streamchar "+r[0]);break}},113:function(e,r){switch(e.curiosys){case 2:var f=L(e,r[0]);if(G(r[0])){var s=Number(f).toString(10);e.code.push("self.Glk.glk_put_jstring("+nr(s)+", true);")}else e.code.push("self.Glk.glk_put_jstring(("+f+").toString(10), true);");break;case 1:I(e),e.code.push("self.stream_num("+e.cp+","+r[0]+", false, 0);"),e.code.push("return;"),e.path_ends=!0;break;case 0:e.code.push("// null streamnum "+r[0]);break}},114:function(e,r){I(e),e.code.push("if (self.stream_string("+e.cp+","+r[0]+", 0, 0)) return;")},115:function(e,r){switch(e.curiosys){case 2:if(G(r[0])){var f=Number(r[0]);e.code.push("self.Glk.glk_put_char_uni("+f+");")}else e.code.push("self.Glk.glk_put_char_uni("+r[0]+");");break;case 1:I(e),e.code.push("self.tempcallargs[0]=("+r[0]+");"),P(e,"0,0"),e.code.push("self.enter_function(self.iosysrock, 1);"),e.code.push("return;"),e.path_ends=!0;break;case 0:e.code.push("// null streamchar "+r[0]);break}},320:function(e,r){e.code.push(r[0]+"self.stringtable)")},321:function(e,r){e.code.push("self.set_string_table("+r[0]+");")},328:function(e,r){e.code.push(r[0]+"self.iosysmode)"),e.code.push(r[1]+"self.iosysrock)")},329:function(e,r){if(e.code.push("self.set_iosys("+r[0]+","+r[1]+");"),G(r[0])){var f=Number(r[0]);e.curiosys=f}else I(e),e.code.push("self.pc = "+e.cp+";"),e.code.push("return;"),e.path_ends=!0},400:function(e,r){var f=L(e,r[0]);if(G(r[0])){var s=Number(f);e.code.push(r[1]+Yr(s)+");")}else e.code.push(r[1]+"self.encode_float("+f+"));")},401:function(e,r){e.varsused.valf=!0,e.varsused.res=!0,e.code.push("valf = "+k(e,r[0])+";"),e.code.push("if (!("+r[0]+" & 0x80000000)) {"),e.code.push("  if (isNaN(valf) || !isFinite(valf) || (valf > 0x7fffffff))"),e.code.push("    res = 0x7fffffff;"),e.code.push("  else"),e.code.push("    res = Math.floor(valf);"),e.code.push("} else {"),e.code.push("  if (isNaN(valf) || !isFinite(valf) || (valf < -0x80000000))"),e.code.push("    res = -0x80000000;"),e.code.push("  else"),e.code.push("    res = Math.ceil(valf);"),e.code.push("}"),e.code.push(r[1]+"res>>>0);")},402:function(e,r){e.varsused.valf=!0,e.varsused.res=!0,e.code.push("valf = "+k(e,r[0])+";"),e.code.push("if (!("+r[0]+" & 0x80000000)) {"),e.code.push("  if (isNaN(valf) || !isFinite(valf))"),e.code.push("    res = 0x7fffffff;"),e.code.push("  else"),e.code.push("    res = Math.round(valf);"),e.code.push("  if (res > 0x7fffffff) res = 0x7fffffff;"),e.code.push("} else {"),e.code.push("  if (isNaN(valf) || !isFinite(valf))"),e.code.push("    res = -0x80000000;"),e.code.push("  else"),e.code.push("    res = Math.round(valf);"),e.code.push("  if (res < -0x80000000) res = -0x80000000;"),e.code.push("}"),e.code.push(r[1]+"res>>>0);")},408:function(e,r){var f=k(e,r[0]);e.code.push(r[1]+"self.encode_float(Math.ceil("+f+")));")},409:function(e,r){var f=k(e,r[0]);e.code.push(r[1]+"self.encode_float(Math.floor("+f+")));")},416:function(e,r){var f=k(e,r[0]),s=k(e,r[1]);e.code.push(r[2]+"self.encode_float("+f+" + "+s+"));")},417:function(e,r){var f=k(e,r[0]),s=k(e,r[1]);e.code.push(r[2]+"self.encode_float("+f+" - "+s+"));")},418:function(e,r){var f=k(e,r[0]),s=k(e,r[1]);e.code.push(r[2]+"self.encode_float("+f+" * "+s+"));")},419:function(e,r){var f=k(e,r[0]),s=k(e,r[1]);e.code.push(r[2]+"self.encode_float("+f+" / "+s+"));")},420:function(e,r){var f=k(e,r[0],!0),s=k(e,r[1],!0);e.varsused.modv=!0,e.varsused.quov=!0,e.code.push("modv=("+f+" % "+s+");"),e.code.push("quov=self.encode_float(("+f+" - modv) / "+s+");"),e.code.push("if (quov == 0x0 || quov == 0x80000000) {"),e.code.push("  quov = (("+r[0]+" ^ "+r[1]+") & 0x80000000) >>>0;"),e.code.push("}"),e.code.push(r[2]+"self.encode_float(modv));"),e.code.push(r[3]+"quov);")},424:function(e,r){var f=k(e,r[0]);e.code.push(r[1]+"self.encode_float(Math.sqrt("+f+")));")},425:function(e,r){var f=k(e,r[0]);e.code.push(r[1]+"self.encode_float(Math.exp("+f+")));")},426:function(e,r){var f=k(e,r[0]);e.code.push(r[1]+"self.encode_float(Math.log("+f+")));")},427:function(e,r){e.varsused.valf=!0;var f=k(e,r[0],!0),s=k(e,r[1],!0);e.code.push("if ("+r[0]+" == 0x3f800000) {"),e.code.push("  valf = 0x3f800000;"),e.code.push("} else if ("+r[0]+" == 0xbf800000 && ("+r[1]+" == 0xff800000 || "+r[1]+" == 0x7f800000)) {"),e.code.push("  valf = 0x3f800000;"),e.code.push("} else {"),e.code.push("  valf=self.encode_float(Math.pow("+f+", "+s+"));"),e.code.push("}"),e.code.push(r[2]+"valf);")},432:function(e,r){var f=k(e,r[0]);e.code.push(r[1]+"self.encode_float(Math.sin("+f+")));")},433:function(e,r){var f=k(e,r[0]);e.code.push(r[1]+"self.encode_float(Math.cos("+f+")));")},434:function(e,r){var f=k(e,r[0]);e.code.push(r[1]+"self.encode_float(Math.tan("+f+")));")},435:function(e,r){var f=k(e,r[0]);e.code.push(r[1]+"self.encode_float(Math.asin("+f+")));")},436:function(e,r){var f=k(e,r[0]);e.code.push(r[1]+"self.encode_float(Math.acos("+f+")));")},437:function(e,r){var f=k(e,r[0]);e.code.push(r[1]+"self.encode_float(Math.atan("+f+")));")},438:function(e,r){var f=k(e,r[0]),s=k(e,r[1]);e.code.push(r[2]+"self.encode_float(Math.atan2("+f+", "+s+")));")},448:function(e,r){var f,s,l,i;e.varsused.fequal=!0,e.varsused.fdiff=!0,e.code.push("if (("+r[2]+" & 0x7f800000) == 0x7f800000 && ("+r[2]+" & 0x007fffff) != 0) {"),e.code.push("  fequal = 0;"),e.code.push("} else if (("+r[0]+" == 0xff800000 || "+r[0]+" == 0x7f800000) && ("+r[1]+" == 0xff800000 || "+r[1]+" == 0x7f800000)) {"),e.code.push("  fequal = ("+r[0]+" == "+r[1]+");"),e.code.push("} else {"),G(r[2])?(f=Number(r[2]),i=""+mr(f&2147483647)):(f="self.decode_float(("+r[2]+") & 0x7fffffff)",i=ee(e),e.code.push(i+"="+f+";")),s=k(e,r[0]),l=k(e,r[1]),e.code.push("  fdiff = "+l+" - "+s+";"),e.code.push("  fequal = (fdiff <= "+i+" && fdiff >= -("+i+"));"),e.code.push("}"),e.code.push("if (fequal) {"),z(e,r[3]),e.code.push("}")},449:function(e,r){var f,s,l,i;e.varsused.fequal=!0,e.varsused.fdiff=!0,e.code.push("if (("+r[2]+" & 0x7f800000) == 0x7f800000 && ("+r[2]+" & 0x007fffff) != 0) {"),e.code.push("  fequal = 0;"),e.code.push("} else if (("+r[0]+" == 0xff800000 || "+r[0]+" == 0x7f800000) && ("+r[1]+" == 0xff800000 || "+r[1]+" == 0x7f800000)) {"),e.code.push("  fequal = ("+r[0]+" == "+r[1]+");"),e.code.push("} else {"),G(r[2])?(f=Number(r[2]),i=""+mr(f&2147483647)):(f="self.decode_float(("+r[2]+") & 0x7fffffff)",i=ee(e),e.code.push(i+"="+f+";")),s=k(e,r[0]),l=k(e,r[1]),e.code.push("  fdiff = "+l+" - "+s+";"),e.code.push("  fequal = (fdiff <= "+i+" && fdiff >= -("+i+"));"),e.code.push("}"),e.code.push("if (!fequal) {"),z(e,r[3]),e.code.push("}")},450:function(e,r){var f,s;f=k(e,r[0]),s=k(e,r[1]),e.code.push("if ("+f+" < "+s+") {"),z(e,r[2]),e.code.push("}")},451:function(e,r){var f,s;f=k(e,r[0]),s=k(e,r[1]),e.code.push("if ("+f+" <= "+s+") {"),z(e,r[2]),e.code.push("}")},452:function(e,r){var f,s;f=k(e,r[0]),s=k(e,r[1]),e.code.push("if ("+f+" > "+s+") {"),z(e,r[2]),e.code.push("}")},453:function(e,r){var f,s;f=k(e,r[0]),s=k(e,r[1]),e.code.push("if ("+f+" >= "+s+") {"),z(e,r[2]),e.code.push("}")},456:function(e,r){e.code.push("if (("+r[0]+" & 0x7f800000) == 0x7f800000 && ("+r[0]+" & 0x007fffff) != 0) {"),z(e,r[1]),e.code.push("}")},457:function(e,r){e.code.push("if ("+r[0]+" == 0xff800000 || "+r[0]+" == 0x7f800000) {"),z(e,r[1]),e.code.push("}")},512:function(e,r){var f=L(e,r[0]);if(G(r[0])){var s=Number(f),l=Kr(s);e.code.push(r[1]+l.lo+");"),e.code.push(r[2]+l.hi+");")}else e.varsused.dbl=!0,e.code.push("dbl=self.encode_double("+f+");"),e.code.push(r[1]+"dbl.lo);"),e.code.push(r[2]+"dbl.hi);")},513:function(e,r){e.varsused.vald=!0,e.varsused.res=!0,e.code.push("vald = "+b(e,r[0],r[1])+";"),e.code.push("if (!("+r[0]+" & 0x80000000)) {"),e.code.push("  if (isNaN(vald) || !isFinite(vald) || (vald > 0x7fffffff))"),e.code.push("    res = 0x7fffffff;"),e.code.push("  else"),e.code.push("    res = Math.floor(vald);"),e.code.push("} else {"),e.code.push("  if (isNaN(vald) || !isFinite(vald) || (vald < -0x80000000))"),e.code.push("    res = -0x80000000;"),e.code.push("  else"),e.code.push("    res = Math.ceil(vald);"),e.code.push("}"),e.code.push(r[2]+"res>>>0);")},514:function(e,r){e.varsused.vald=!0,e.varsused.res=!0,e.code.push("vald = "+b(e,r[0],r[1])+";"),e.code.push("if (!("+r[0]+" & 0x80000000)) {"),e.code.push("  if (isNaN(vald) || !isFinite(vald))"),e.code.push("    res = 0x7fffffff;"),e.code.push("  else"),e.code.push("    res = Math.round(vald);"),e.code.push("  if (res > 0x7fffffff) res = 0x7fffffff;"),e.code.push("} else {"),e.code.push("  if (isNaN(vald) || !isFinite(vald))"),e.code.push("    res = -0x80000000;"),e.code.push("  else"),e.code.push("    res = Math.round(vald);"),e.code.push("  if (res < -0x80000000) res = -0x80000000;"),e.code.push("}"),e.code.push(r[2]+"res>>>0);")},515:function(e,r){var f=k(e,r[0]);e.varsused.dbl=!0,e.code.push("dbl=self.encode_double("+f+");"),e.code.push(r[1]+"dbl.lo);"),e.code.push(r[2]+"dbl.hi);")},516:function(e,r){var f=b(e,r[0],r[1]);e.code.push(r[2]+"self.encode_float("+f+"));")},520:function(e,r){var f=b(e,r[0],r[1]);e.varsused.dbl=!0,e.code.push("dbl=self.encode_double(Math.ceil("+f+"));"),e.code.push(r[2]+"dbl.lo);"),e.code.push(r[3]+"dbl.hi);")},521:function(e,r){var f=b(e,r[0],r[1]);e.varsused.dbl=!0,e.code.push("dbl=self.encode_double(Math.floor("+f+"));"),e.code.push(r[2]+"dbl.lo);"),e.code.push(r[3]+"dbl.hi);")},528:function(e,r){var f=b(e,r[0],r[1]),s=b(e,r[2],r[3]);e.varsused.dbl=!0,e.code.push("dbl=self.encode_double("+f+" + "+s+");"),e.code.push(r[4]+"dbl.lo);"),e.code.push(r[5]+"dbl.hi);")},529:function(e,r){var f=b(e,r[0],r[1]),s=b(e,r[2],r[3]);e.varsused.dbl=!0,e.code.push("dbl=self.encode_double("+f+" - "+s+");"),e.code.push(r[4]+"dbl.lo);"),e.code.push(r[5]+"dbl.hi);")},530:function(e,r){var f=b(e,r[0],r[1]),s=b(e,r[2],r[3]);e.varsused.dbl=!0,e.code.push("dbl=self.encode_double("+f+" * "+s+");"),e.code.push(r[4]+"dbl.lo);"),e.code.push(r[5]+"dbl.hi);")},531:function(e,r){var f=b(e,r[0],r[1]),s=b(e,r[2],r[3]);e.varsused.dbl=!0,e.code.push("dbl=self.encode_double("+f+" / "+s+");"),e.code.push(r[4]+"dbl.lo);"),e.code.push(r[5]+"dbl.hi);")},532:function(e,r){var f=b(e,r[0],r[1]),s=b(e,r[2],r[3]);e.varsused.dbl=!0,e.code.push("dbl=self.encode_double("+f+" % "+s+");"),e.code.push(r[4]+"dbl.lo);"),e.code.push(r[5]+"dbl.hi);")},533:function(e,r){e.varsused.vald1=!0,e.varsused.vald2=!0,e.code.push("vald1 = "+b(e,r[0],r[1])+";"),e.code.push("vald2 = "+b(e,r[2],r[3])+";"),e.varsused.dbl=!0,e.varsused.modv=!0,e.varsused.quov=!0,e.code.push("modv=(vald1 % vald2);"),e.code.push("dbl=self.encode_double((vald1 - modv) / vald2);"),e.code.push("if ((dbl.hi == 0x0 || dbl.hi == 0x80000000) && dbl.lo == 0x0) {"),e.code.push("  dbl.hi = (("+r[0]+" ^ "+r[2]+") & 0x80000000) >>>0;"),e.code.push("}"),e.code.push(r[4]+"dbl.lo);"),e.code.push(r[5]+"dbl.hi);")},536:function(e,r){var f=b(e,r[0],r[1]);e.varsused.dbl=!0,e.code.push("dbl=self.encode_double(Math.sqrt("+f+"));"),e.code.push(r[2]+"dbl.lo);"),e.code.push(r[3]+"dbl.hi);")},537:function(e,r){var f=b(e,r[0],r[1]);e.varsused.dbl=!0,e.code.push("dbl=self.encode_double(Math.exp("+f+"));"),e.code.push(r[2]+"dbl.lo);"),e.code.push(r[3]+"dbl.hi);")},538:function(e,r){var f=b(e,r[0],r[1]);e.varsused.dbl=!0,e.code.push("dbl=self.encode_double(Math.log("+f+"));"),e.code.push(r[2]+"dbl.lo);"),e.code.push(r[3]+"dbl.hi);")},539:function(e,r){e.varsused.dbl=!0;var f=b(e,r[0],r[1],!0),s=b(e,r[2],r[3],!0);e.code.push("if ("+r[0]+" == 0x3ff00000 && "+r[1]+" == 0x0) {"),e.code.push("  dbl = { hi:0x3ff00000, lo:0x0 };"),e.code.push("} else if ("+r[0]+" == 0xbff00000 && "+r[1]+" == 0x0 && ("+r[2]+" == 0xfff00000 || "+r[2]+" == 0x7ff00000) && "+r[3]+" == 0x0) {"),e.code.push("  dbl = { hi:0x3ff00000, lo:0x0 };"),e.code.push("} else {"),e.code.push("  dbl=self.encode_double(Math.pow("+f+", "+s+"));"),e.code.push("}"),e.code.push(r[4]+"dbl.lo);"),e.code.push(r[5]+"dbl.hi);")},544:function(e,r){var f=b(e,r[0],r[1]);e.varsused.dbl=!0,e.code.push("dbl=self.encode_double(Math.sin("+f+"));"),e.code.push(r[2]+"dbl.lo);"),e.code.push(r[3]+"dbl.hi);")},545:function(e,r){var f=b(e,r[0],r[1]);e.varsused.dbl=!0,e.code.push("dbl=self.encode_double(Math.cos("+f+"));"),e.code.push(r[2]+"dbl.lo);"),e.code.push(r[3]+"dbl.hi);")},546:function(e,r){var f=b(e,r[0],r[1]);e.varsused.dbl=!0,e.code.push("dbl=self.encode_double(Math.tan("+f+"));"),e.code.push(r[2]+"dbl.lo);"),e.code.push(r[3]+"dbl.hi);")},547:function(e,r){var f=b(e,r[0],r[1]);e.varsused.dbl=!0,e.code.push("dbl=self.encode_double(Math.asin("+f+"));"),e.code.push(r[2]+"dbl.lo);"),e.code.push(r[3]+"dbl.hi);")},548:function(e,r){var f=b(e,r[0],r[1]);e.varsused.dbl=!0,e.code.push("dbl=self.encode_double(Math.acos("+f+"));"),e.code.push(r[2]+"dbl.lo);"),e.code.push(r[3]+"dbl.hi);")},549:function(e,r){var f=b(e,r[0],r[1]);e.varsused.dbl=!0,e.code.push("dbl=self.encode_double(Math.atan("+f+"));"),e.code.push(r[2]+"dbl.lo);"),e.code.push(r[3]+"dbl.hi);")},550:function(e,r){var f=b(e,r[0],r[1]),s=b(e,r[2],r[3]);e.varsused.dbl=!0,e.code.push("dbl=self.encode_double(Math.atan2("+f+", "+s+"));"),e.code.push(r[4]+"dbl.lo);"),e.code.push(r[5]+"dbl.hi);")},560:function(e,r){var f,s,l,i,t,h;e.varsused.dequal=!0,e.varsused.ddiff=!0,e.code.push("if (("+r[4]+" & 0x7ff00000) == 0x7ff00000 && (("+r[4]+" & 0xfffff) != 0x0 || "+r[5]+" != 0x0)) {"),e.code.push("  dequal = 0;"),e.code.push("} else if (("+r[0]+" == 0xfff00000 || "+r[0]+" == 0x7ff00000) && ("+r[1]+" == 0x0) && ("+r[2]+" == 0xfff00000 || "+r[2]+" == 0x7ff00000) && ("+r[3]+" == 0x0)) {"),e.code.push("  dequal = ("+r[0]+" == "+r[2]+" && "+r[1]+" == "+r[3]+");"),e.code.push("} else {"),G(r[4])&&G(r[5])?(s=Number(r[4]),l=Number(r[5]),h=""+wr(s&2147483647,l&2147483647)):(f="self.decode_double((("+r[4]+") & 0x7fffffff), ("+r[5]+"))",h=ee(e),e.code.push(h+"="+f+";")),i=b(e,r[0],r[1]),t=b(e,r[2],r[3]),e.code.push("  ddiff = "+t+" - "+i+";"),e.code.push("  dequal = (ddiff <= "+h+" && ddiff >= -("+h+"));"),e.code.push("}"),e.code.push("if (dequal) {"),z(e,r[6]),e.code.push("}")},561:function(e,r){var f,s,l,i,t,h;e.varsused.dequal=!0,e.varsused.ddiff=!0,e.code.push("if (("+r[4]+" & 0x7ff00000) == 0x7ff00000 && (("+r[4]+" & 0xfffff) != 0x0 || "+r[5]+" != 0x0)) {"),e.code.push("  dequal = 0;"),e.code.push("} else if (("+r[0]+" == 0xfff00000 || "+r[0]+" == 0x7ff00000) && ("+r[1]+" == 0x0) && ("+r[2]+" == 0xfff00000 || "+r[2]+" == 0x7ff00000) && ("+r[3]+" == 0x0)) {"),e.code.push("  dequal = ("+r[0]+" == "+r[2]+" && "+r[1]+" == "+r[3]+");"),e.code.push("} else {"),G(r[4])&&G(r[5])?(s=Number(r[4]),l=Number(r[5]),h=""+wr(s&2147483647,l&2147483647)):(f="self.decode_double((("+r[4]+") & 0x7fffffff), ("+r[5]+"))",h=ee(e),e.code.push(h+"="+f+";")),i=b(e,r[0],r[1]),t=b(e,r[2],r[3]),e.code.push("  ddiff = "+t+" - "+i+";"),e.code.push("  dequal = (ddiff <= "+h+" && ddiff >= -("+h+"));"),e.code.push("}"),e.code.push("if (!dequal) {"),z(e,r[6]),e.code.push("}")},562:function(e,r){var f=b(e,r[0],r[1]),s=b(e,r[2],r[3]);e.code.push("if ("+f+" < "+s+") {"),z(e,r[4]),e.code.push("}")},563:function(e,r){var f=b(e,r[0],r[1]),s=b(e,r[2],r[3]);e.code.push("if ("+f+" <= "+s+") {"),z(e,r[4]),e.code.push("}")},564:function(e,r){var f=b(e,r[0],r[1]),s=b(e,r[2],r[3]);e.code.push("if ("+f+" > "+s+") {"),z(e,r[4]),e.code.push("}")},565:function(e,r){var f=b(e,r[0],r[1]),s=b(e,r[2],r[3]);e.code.push("if ("+f+" >= "+s+") {"),z(e,r[4]),e.code.push("}")},568:function(e,r){e.code.push("if ((("+r[0]+" & 0x7ff00000) == 0x7ff00000) && (("+r[0]+" & 0xfffff) != 0x0 || "+r[1]+" != 0x0)) {"),z(e,r[2]),e.code.push("}")},569:function(e,r){e.code.push("if (("+r[0]+" == 0xfff00000 || "+r[0]+" == 0x7ff00000) && "+r[1]+" == 0x0) {"),z(e,r[2]),e.code.push("}")},304:function(e,r){var f;if(G(r[0])?f=u.Glk.call_may_not_return(Number(r[0])):f=!0,f&&(e.code.push("  self.prevpc = "+e.prevcp+";"),e.code.push("  self.pc = "+e.cp+";")),e.code.push("self.tempglkargs.length = "+r[1]+";"),G(r[1])){var s,l=Number(r[1]);for(s=0;s<l;s++)if(e.offstack.length){var i=je(e);e.code.push("self.tempglkargs["+s+"]="+i+";")}else e.code.push("self.tempglkargs["+s+"]=self.frame.valstack.pop();");I(e)}else e.varsused.ix=!0,I(e),e.code.push("for (ix=0; ix<"+r[1]+"; ix++) { self.tempglkargs[ix]=self.frame.valstack.pop(); }");e.varsused.glkret=!0,e.code.push("glkret = self.GiDispa.get_function("+r[0]+")(self.tempglkargs);"),f&&(e.code.push("if (glkret === self.Glk.DidNotReturn) {"),e.code.push("  self.resumefuncop = "+M(r[2])+";"),e.code.push("  self.resumevalue = 0;"),e.code.push("  self.pc = "+e.cp+";"),e.code.push("  self.done_executing = true;"),e.code.push("  return;"),e.code.push("}")),B(e,r[2],"glkret")}};function ee(e,r){for(var f=0,s;;){if(s="_hold"+f,!e.holduse[s])return e.holduse[s]=r?1:!0,s;f++}}function je(e){var r=e.offstack.pop();if(G(r))return r;var f=e.holduse[r];return(isNaN(f)||f===!1||f===!0)&&p("Offstack variable not marked as stack.",r),f--,f==0&&(f=!0),e.holduse[r]=f,r}function C(e,r){e.offstack.push(r);var f=e.holduse[r];!f||f===!0?f=1:f++,e.holduse[r]=f}function te(e,r,f,s){var l=e.offloc[r];if(l&&sr(l)){var i=e.holduse[l];i--,i==0&&(i=!0),e.holduse[l]=i}if(f===void 0){e.offloc[r]=void 0,e.offlocdirty[r]=!1;return}if(e.offloc[r]=f,e.offlocdirty[r]=!0,s){var t=f,i=e.holduse[t];!i||i===!0?i=1:i++,e.holduse[t]=i}}function fr(e,r){for(var f;e.offstack.length<r;)f=ee(e,!0),e.offstack.unshift(f),e.code.push(f+"=self.frame.valstack.pop();")}function G(e){return e[0]==="0"}function sr(e){return e[0]==="_"}function Mr(e,r,f,s){var l,i,t,h,d,a,F;for(s.desttype=0,s.numops=f.numops,l=r,r+=f.numops+1>>1,i=0;i<f.numops;i++){i&1?(h=t>>4&15,l++):(t=n(l),h=t&15);var j=f.formlist[i];if(j=="L"){switch(h){case 8:e.offstack.length?s[i]=je(e):(F=ee(e),e.code.push(F+"=self.frame.valstack.pop();"),s[i]=F);continue;case 0:s[i]="0";continue;case 1:d=Ge(r),r++,s[i]=d;continue;case 2:d=ze(r),r+=2,s[i]=d;continue;case 3:d=ie(r),r+=4,s[i]=d;continue}if(h>=9&&h<=11){if(h==9?(a=n(r),r++):h==10?(a=v(r),r+=2):h==11&&(a=g(r),r+=4),e.offloc[a]!==void 0){s[i]=e.offloc[a];continue}f.argsize==4?d="self.frame.locals["+a+"]":f.argsize==2?d="self.frame.locals["+a+"] & 0xffff":d="self.frame.locals["+a+"] & 0xff",F=ee(e,!0),e.code.push(F+"=("+d+");"),e.offloc[a]=F,e.offlocdirty[a]=!1,s[i]=F;continue}switch(h){case 15:a=g(r)+U,r+=4;break;case 14:a=v(r)+U,r+=2;break;case 13:a=n(r)+U,r++;break;case 7:a=g(r),r+=4;break;case 6:a=v(r),r+=2;break;case 5:a=n(r),r++;break;default:p("Unknown addressing mode in load operand.")}f.argsize==4?d="self.Mem4("+a+")":f.argsize==2?d="self.Mem2("+a+")":d="self.Mem1("+a+")",F=ee(e),e.code.push(F+"=("+d+");"),s[i]=F;continue}else if(j=="E"){switch(h){case 8:e.offstack.length?s[i]=je(e):s[i]="self.frame.valstack.pop()";continue;case 0:s[i]="0";continue;case 1:d=Ge(r),r++,s[i]=d;continue;case 2:d=ze(r),r+=2,s[i]=d;continue;case 3:d=ie(r),r+=4,s[i]=d;continue}if(h>=9&&h<=11){if(h==9?(a=n(r),r++):h==10?(a=v(r),r+=2):h==11&&(a=g(r),r+=4),e.offloc[a]!==void 0){s[i]=e.offloc[a];continue}f.argsize==4?d="self.frame.locals["+a+"]":f.argsize==2?d="self.frame.locals["+a+"] & 0xffff":d="self.frame.locals["+a+"] & 0xff",F=ee(e,!0),e.code.push(F+"=("+d+");"),e.offloc[a]=F,e.offlocdirty[a]=!1,s[i]=F;continue}switch(h){case 15:a=g(r)+U,r+=4;break;case 14:a=v(r)+U,r+=2;break;case 13:a=n(r)+U,r++;break;case 7:a=g(r),r+=4;break;case 6:a=v(r),r+=2;break;case 5:a=n(r),r++;break;default:p("Unknown addressing mode in load operand.")}f.argsize==4?d="self.Mem4("+a+")":f.argsize==2?d="self.Mem2("+a+")":d="self.Mem1("+a+")",s[i]=d;continue}else if(j=="S"){switch(h){case 8:F=ee(e,!0),e.offstack.push(F),s[i]=F+"=(";continue;case 0:s[i]="(";continue}if(h>=9&&h<=11){h==9?(a=n(r),r++):h==10?(a=v(r),r+=2):h==11&&(a=g(r),r+=4),f.argsize==4?(F=ee(e,!0),te(e,a,F,!1),s[i]=F+"=("):f.argsize==2?(te(e,a,void 0),s[i]="self.frame.locals["+a+"]=(0xffff &"):(te(e,a,void 0),s[i]="self.frame.locals["+a+"]=(0xff &");continue}switch(h){case 15:a=g(r)+U,r+=4;break;case 14:a=v(r)+U,r+=2;break;case 13:a=n(r)+U,r++;break;case 7:a=g(r),r+=4;break;case 6:a=v(r),r+=2;break;case 5:a=n(r),r++;break;default:p("Unknown addressing mode in store operand.")}f.argsize==4?d="self.MemW4("+a+",":f.argsize==2?d="self.MemW2("+a+",":d="self.MemW1("+a+",",s[i]=d;continue}else if(j=="F"){var E=s.func_store;switch(h){case 8:E.mode=8,E.argsize=f.argsize,s[i]=E;continue;case 0:E.mode=0,E.argsize=f.argsize,s[i]=E;continue}if(h>=9&&h<=11){h==9?(a=n(r),r++):h==10?(a=v(r),r+=2):h==11&&(a=g(r),r+=4),E.mode=11,E.addr=a,E.argsize=f.argsize,s[i]=E;continue}switch(h){case 15:a=g(r)+U,r+=4;break;case 14:a=v(r)+U,r+=2;break;case 13:a=n(r)+U,r++;break;case 7:a=g(r),r+=4;break;case 6:a=v(r),r+=2;break;case 5:a=n(r),r++;break;default:p("Unknown addressing mode in store operand.")}E.mode=15,E.addr=a,E.argsize=f.argsize,s[i]=E;continue}else if(j=="C"){switch(h){case 8:s[i]="3,0";continue;case 0:s[i]="0,0";continue}if(h>=9&&h<=11){h==9?(a=n(r),r++):h==10?(a=v(r),r+=2):h==11&&(a=g(r),r+=4),s[i]="2,"+a;continue}switch(h){case 15:a=g(r)+U,r+=4;break;case 14:a=v(r)+U,r+=2;break;case 13:a=n(r)+U,r++;break;case 7:a=g(r),r+=4;break;case 6:a=v(r),r+=2;break;case 5:a=n(r),r++;break;default:p("Unknown addressing mode in store operand.")}s[i]="1,"+a;continue}else p("Unknown operand type.",j)}return r}function zf(e){var r=e,f=n(r);f!=192&&f!=193&&(f>=192&&f<=223?p("Call to unknown type of function.",r):p("Call to non-function.",r)),r++;for(var s=[],l=r,i=0;;){var t=n(r);r++;var h=n(r);if(r++,t==0)break;t!=1&&t!=2&&t!=4&&p("Invalid local variable size in function header.",t),s.push({size:t,count:h})}for(var d=y.slice(l,r);d.length%4;)d.push(0);return new hr(e,r,s,d)}function Nf(e,r,f){var s=r,l,i,t,h={vmfunc:e,cp:null,prevcp:null,curiosys:f,code:[],holduse:{},varsused:{},offstack:[],offloc:[],offlocdirty:[],path_ends:!1},d={};for(d.func_store={},h.code.push("");!h.path_ends;){h.prevcp=s,i=s,l=n(s),l===void 0&&p("Tried to compile nonexistent address",s),s++,l&128&&(l&64?(l&=63,l=l*256|n(s),s++,l=l*256|n(s),s++,l=l*256|n(s),s++):(l&=127,l=l*256|n(s),s++)),h.code.push("// "+i.toString(16)+": opcode "+l.toString(16));var a=m[l];a||p("Encountered unknown opcode.",l),s=Mr(h,s,a,d),h.cp=s;var F=rr[l];F||p("Encountered unhandled opcode.",l),F(h,d);for(t in h.holduse)h.holduse[t]===!0&&(h.holduse[t]=!1);h.offstack.length&&h.code.push("// offstack: "+h.offstack.join(",")),h.offloc.length&&h.code.push("// offloc: "+h.offloc.join(",")+"; dirty: "+h.offlocdirty.join(",")),e.pathaddrs[s]&&!h.path_ends&&(h.code.push("// reached jump-in point"),h.code.push("self.pc="+s+";"),I(h),h.code.push("return;"),h.path_ends=!0)}h.offstack.length&&p("Path compilation ended with nonempty offstack.",h.offstack.length),h.offloc.length&&p("Path compilation ended with nonempty offloc.",h.offloc.length);{var j=[];for(t in h.holduse)j.push(t);for(t in h.varsused)j.push(t);j.length&&(h.code[0]="var "+j.join(",")+";")}return tr(h.code.join(`
`),"_func_path_"+r)}function Lr(e,r){var f;af++;var s=Sr[e];if(s!==void 0){nf++;var l=s(r,u.tempcallargs);Cr(l);return}var i=jr[e];i===void 0&&(i=zf(e),e<U&&(jr[e]=i)),u.pc=i.startpc;var t=new qe(i);if(t.depth=W.length,W.length==0?t.framestart=0:t.framestart=u.frame.framestart+u.frame.framelen+4*u.frame.valstack.length,W.push(t),u.frame=t,i.functype==192){for(f=r-1;f>=0;f--)u.frame.valstack.push(u.tempcallargs[f]);u.frame.valstack.push(r)}else for(f=0;f<r;f++){var h=i.localsindex[f];if(h===void 0)break;h.size==4?u.frame.locals[h.pos]=u.tempcallargs[f]:h.size==2?u.frame.locals[h.pos]=u.tempcallargs[f]&65535:h.size==1&&(u.frame.locals[h.pos]=u.tempcallargs[f]&255)}}u.enter_function=Lr;function Af(){var e=u.frame.depth;if(W.pop(),W.length==0)return u.frame=null,!0;u.frame=W[W.length-1],u.frame.depth!=e-1&&p("Stack inconsistent after function exit.")}u.leave_function=Af;function Bf(e){for(;W.length&&W[W.length-1].framestart>e;)W.pop();W.length==0&&p("Stack evaporated during throw."),u.frame=W[W.length-1],e-=u.frame.framestart+u.frame.framelen,e<0&&p("Attempted to throw below the frame value stack."),e&3&&p("Attempted to throw to an unaligned address."),e>>>=2,e>u.frame.valstack.length&&p("Attempted to throw beyond the frame value stack."),u.frame.valstack.length=e}u.pop_stack_to=Bf;function Cr(e){var r,f;isNaN(e)&&p("Function returned undefined value.");var s=u.frame.valstack,l=s.length,i=s[l-1];switch(i!=u.frame.framestart&&(s.length-=1,p("Call stub frameptr ("+i+") does not match frame ("+u.frame.framestart+")")),u.pc=s[l-2],r=s[l-3],f=s[l-4],s.length-=4,f){case 0:return;case 1:q(r,e);return;case 2:u.frame.locals[r]=e;return;case 3:u.frame.valstack.push(e);return;case 17:p("String-terminator call stub at end of function call.");return;case 16:vr(0,u.pc,225,r);return;case 18:Jr(0,u.pc,!0,r);return;case 19:vr(0,u.pc,224,r);return;case 20:vr(0,u.pc,226,r);return;default:p("Unrecognized desttype in callstub.",f)}}u.pop_callstub=Cr;function qf(e,r,f){switch(e){case 0:return;case 1:q(r,f);return;case 2:u.frame.locals[r]=f;return;case 3:u.frame.valstack.push(f);return;default:p("Unrecognized desttype in callstub.",e)}}u.store_operand=qf;function jf(e,r){if(e)switch(e.mode){case 8:u.frame.valstack.push(r);return;case 0:return;case 11:e.argsize==4?u.frame.locals[e.addr]=r:e.argsize==2?u.frame.locals[e.addr]=65535&r:u.frame.locals[e.addr]=255&r;return;case 15:e.argsize==4?q(e.addr,r):e.argsize==2?S(e.addr,r):Ae(e.addr,r);return;default:p("Unknown addressing mode in store func by operand.")}}function Ef(){var e=u.prevpc,r=n(e);return e++,r&128&&(r&64?(r&=63,r=r<<8|n(e),e++,r=r<<8|n(e),e++,r=r<<8|n(e),e++):(r&=127,r=r<<8|n(e),e++)),r!=304?(O("parse_partial_operand: parsed wrong opcode: "+r),null):{selop:n(e)&15,argsop:n(e)>>4&15,resop:n(e+1)&15}}function dr(e){e==0?u.random_func=Math.random:(Wf(e),u.random_func=Hr)}u.set_random=dr;var _e=void 0,Ve,Je;function Wf(e){var r,f,s,l,i;for(_e===void 0&&(_e=Array(55)),_e[54]=e,Ve=0,Je=31,s=1,r=0;r<55;r++)f=21*r%55,_e[f]=s,s=e-s>>>0,e=_e[f];for(i=0;i<4;i++)for(r=0;r<55;r++)l=_e[r]-_e[(1+r+30)%55],_e[r]=l>>>0}function Hr(){return Ve=(Ve+1)%55,Je=(Je+1)%55,_e[Ve]=_e[Ve]-_e[Je]>>>0,_e[Ve]/4294967296}var Sr={},ur={};u.accel_address_map=Sr,u.accel_funcnum_map=ur;var N=[0,0,0,0,0,0,0,0,0];u.accel_params=N;function Xe(e){u.iosysmode==2&&u.Glk.glk_put_jstring(e)}var oe={1:function(r,f){if(r<1)return 0;var s=f[0];if(s<36||s>=u.endmem)return 0;var l=n(s);return l>=224?3:l>=192?2:l>=112&&l<=127&&s>=U?1:0},2:function(r,f){var s=r>0?f[0]:0,l=r>1?f[1]:0;if(oe[1](r,f)!=1)return Xe(`
[** Programming error: tried to find the "." of (something) **]
`),0;var i=g(s+16);if(!i)return 0;var t=g(i);return i+=4,Br(l,2,i,10,t,0,0)},3:function(r,f){var s=r>0?f[0]:0,l=r>1?f[1]:0,i=Gr(s,l);return i==0?0:g(i+4)},4:function(r,f){var s=r>0?f[0]:0,l=r>1?f[1]:0,i=Gr(s,l);return i==0?0:4*v(i+2)},5:function(r,f){var s,l,i,t,h,d=r>0?f[0]:0,a=r>1?f[1]:0;if(s=oe[1](r,f),s==3)return a==N[5]?1:0;if(s==2)return a==N[4]?1:0;if(s!=1)return 0;if(a==N[2])return Ne(d)||d==N[2]||d==N[5]||d==N[4]||d==N[3]?1:0;if(a==N[3])return Ne(d)||d==N[2]||d==N[5]||d==N[4]||d==N[3]?0:1;if(a==N[5]||a==N[4])return 0;if(!Ne(a))return Xe(`
[** Programming error: tried to apply 'ofclass' with non-class **]
`),0;if(l=Gr(d,2),l==0||(i=g(l+4),i==0))return 0;for(t=v(l+2),h=0;h<t;h++)if(g(i+4*h)==a)return 1;return 0},6:function(r,f){var s=r>1?f[1]:0,l;return l=oe[3](r,f),l==0?s>0&&s<N[1]?g(N[8]+4*s):(Xe(`
[** Programming error: tried to read (something) **]
`),0):g(l)},7:function(r,f){var s=r>0?f[0]:0,l=r>1?f[1]:0,i=N[1],t=oe[1](r,f);return t==3?l==i+6||l==i+7?1:0:t==2?l==i+5?1:0:t!=1?0:l>=i&&l<i+8&&Ne(s)||oe[3](r,f)?1:0},8:function(r,f){var s=r>0?f[0]:0,l=r>1?f[1]:0;if(oe[1](r,f)!=1)return Xe(`
[** Programming error: tried to find the "." of (something) **]
`),0;var i=g(s+4*(3+(N[7]>>2)));if(!i)return 0;var t=g(i);return i+=4,Br(l,2,i,10,t,0,0)},9:function(r,f){var s=r>0?f[0]:0,l=r>1?f[1]:0,i=zr(s,l);return i==0?0:g(i+4)},10:function(r,f){var s=r>0?f[0]:0,l=r>1?f[1]:0,i=zr(s,l);return i==0?0:4*v(i+2)},11:function(r,f){var s,l,i,t,h,d=r>0?f[0]:0,a=r>1?f[1]:0;if(s=oe[1](r,f),s==3)return a==N[5]?1:0;if(s==2)return a==N[4]?1:0;if(s!=1)return 0;if(a==N[2])return Ne(d)||d==N[2]||d==N[5]||d==N[4]||d==N[3]?1:0;if(a==N[3])return Ne(d)||d==N[2]||d==N[5]||d==N[4]||d==N[3]?0:1;if(a==N[5]||a==N[4])return 0;if(!Ne(a))return Xe(`
[** Programming error: tried to apply 'ofclass' with non-class **]
`),0;if(l=zr(d,2),l==0||(i=g(l+4),i==0))return 0;for(t=v(l+2),h=0;h<t;h++)if(g(i+4*h)==a)return 1;return 0},12:function(r,f){var s=r>1?f[1]:0,l;return l=oe[9](r,f),l==0?s>0&&s<N[1]?g(N[8]+4*s):(Xe(`
[** Programming error: tried to read (something) **]
`),0):g(l)},13:function(r,f){var s=r>0?f[0]:0,l=r>1?f[1]:0,i=N[1],t=oe[1](r,f);return t==3?l==i+6||l==i+7?1:0:t==2?l==i+5?1:0:t!=1?0:l>=i&&l<i+8&&Ne(s)||oe[9](r,f)?1:0}};u.accel_func_map=oe;var Me=[0,0];function Ne(e){return g(e+13+N[7])==N[2]}function Gr(e,r){var f=0,s;if(r&4294901760){if(f=g(N[0]+(r&65535)*4),Me[0]=e,Me[1]=f,oe[5](2,Me)==0)return 0;r=r>>16,e=f}return Me[0]=e,Me[1]=r,s=oe[2](2,Me),s==0||Ne(e)&&f==0&&(r<N[1]||r>=N[1]+8)||g(N[6])!=e&&n(s+9)&1?0:s}function zr(e,r){var f=0,s;if(r&4294901760){if(f=g(N[0]+(r&65535)*4),Me[0]=e,Me[1]=f,oe[11](2,Me)==0)return 0;r=r>>16,e=f}return Me[0]=e,Me[1]=r,s=oe[8](2,Me),s==0||Ne(e)&&f==0&&(r<N[1]||r>=N[1]+8)||g(N[6])!=e&&n(s+9)&1?0:s}function Nr(e){if(u.stringtable!=e&&(Ee=void 0,Re=void 0,u.stringtable=e,u.stringtable!=0)){var r=gr[u.stringtable];if(r===void 0){var f=void 0,s=g(u.stringtable),l=g(u.stringtable+8),i=u.stringtable+s<=U;if(i){var t=Array(1);_r(t,l,4,0),f=t[0],f===void 0&&p("Failed to create decoding tree.")}r=new xr(u.stringtable,f),gr[u.stringtable]=r}Ee=r.decoding_tree,Re=r.vmstring_tables[u.iosysmode]}}u.set_string_table=Nr;function $r(e,r){switch(e){case 0:r=0;break;case 1:break;case 2:r=0;break;default:e=0,r=0;break}u.iosysmode=e,u.iosysrock=r;var f=gr[u.stringtable];f===void 0?Re=void 0:Re=f.vmstring_tables[u.iosysmode]}u.set_iosys=$r;function _r(e,r,f,s){var l,i,t,h;if(i=n(r),i==0&&f==4){t=Array(16),t.type=0,t.depth=4,e[s]=t,_r(t,r,0,0);return}if(i==0){var d=g(r+1),a=g(r+5);_r(e,d,f+1,s),_r(e,a,f+1,s|1<<f);return}switch(r++,t={},t.type=i,t.depth=f,i){case 2:t.value=n(r),t.cchar=xe(t.value);break;case 4:t.value=g(r),t.cchar=xe(t.value);break;case 3:case 5:t.addr=r;break;case 8:case 9:t.addr=g(r);break;case 10:case 11:t.addr=r;break;case 1:break;default:p("Unknown node type in string table.",i)}for(h=1<<f,l=s;l<16;l+=h)e[l]=t}function Jr(e,r,f,s){var l=(r&4294967295).toString(10);switch(u.iosysmode){case 2:s&&(l=l.slice(s)),u.Glk.glk_put_jstring(l,!0);break;case 1:if(f||(u.frame.valstack.push(17,0,e,u.frame.framestart),f=!0),s<l.length){var i=l.charCodeAt(s);return u.frame.valstack.push(18,s+1,r,u.frame.framestart),u.tempcallargs[0]=i,Lr(u.iosysrock,1),!0}break;case 0:break}if(f){var t,h;u.frame.valstack.pop()!=u.frame.framestart&&p("Call stub frameptr does not match frame."),u.pc=u.frame.valstack.pop(),h=u.frame.valstack.pop(),t=u.frame.valstack.pop(),t!=17&&p("String-on-string call stub while printing number.")}}u.stream_num=Jr;function vr(e,r,f,s){for(var l=f!=0,i,t,h,d,a;;){if(t=void 0,f==0?i=r:i=r+"/"+f+"/"+s,Re!==void 0&&r<U?(t=Re[i],t===void 0&&(t=Xr(u.iosysmode,r,f,s),Re[i]=t,Er++,of++)):(t=Xr(u.iosysmode,r,f,s),Er++),t instanceof Function){if(h=t(u,e,l),h instanceof Array){l=!0,r=h[0],f=h[1],s=h[2];continue}if(h)return!0}else if(t.length!=0&&u.Glk.glk_put_jstring(t),!l)return!1;if(u.frame.valstack.pop()!=u.frame.framestart&&p("Call stub frameptr does not match frame."),u.pc=u.frame.valstack.pop(),a=u.frame.valstack.pop(),d=u.frame.valstack.pop(),d==17)return!0;d==16?(l=!0,s=a,f=225,r=u.pc):p("Function-terminator call stub at end of string.")}}u.stream_string=vr;function Xr(e,r,f,s){var l=r,i=s,t=void 0,h,d;l||p("Called compile_string with null address.");var a={startaddr:r,startbitnum:s,buffer:[],code:[]};if(f==0?(d=n(l),d==226?l+=4:l++,i=0):d=f,d==225)if(Ee){var F,j,E,Q,X,T,fe=!1;for(F=n(l),i&&(F>>=i),j=8-i,E=!1,Ee instanceof Array||(fe=!0),X=Ee;!fe;){if(j<4){var De=n(l+1);F|=De<<j,j+=8,E=!0}if(T=X[F&15],j-=T.depth,F>>=T.depth,i+=T.depth,i>=8)if(l+=1,i-=8,E)E=!1;else{var De=n(l);F|=De<<j,j+=8}if(T instanceof Array){X=T;continue}switch(T.type){case 1:fe=!0;break;case 2:case 4:switch(e){case 2:a.buffer.push(T.cchar);break;case 1:ue(a),V(a),P(a,"0x10,"+i,l),a.code.push("self.tempcallargs[0]="+T.value+";"),a.code.push("self.enter_function(self.iosysrock, 1);"),t=!0,fe=!0;break}X=Ee;break;case 3:switch(e){case 2:for(Q=T.addr;h=n(Q),h!=0;)a.buffer.push(xe(h)),Q++;break;case 1:ue(a),V(a),P(a,"0x10,"+i,l),t="["+T.addr+", 0xE0, 0]",fe=!0;break}X=Ee;break;case 5:switch(e){case 2:for(Q=T.addr;h=g(Q),h!=0;)a.buffer.push(xe(h)),Q+=4;break;case 1:ue(a),V(a),P(a,"0x10,"+i,l),t="["+T.addr+", 0xE2, 0]",fe=!0;break}X=Ee;break;case 8:case 9:case 10:case 11:ue(a),V(a),a.code.push("var otype, retval;"),a.code.push("var oaddr = "+T.addr+";"),T.type>=9&&a.code.push("oaddr = self.Mem4(oaddr);"),T.type==11&&a.code.push("oaddr = self.Mem4(oaddr);"),a.code.push("otype = self.Mem1(oaddr);"),t="retval",fe=!0,P(a,"0x10,"+i,l),a.code.push("if (otype >= 0xE0 && otype <= 0xFF) {"),a.code.push("retval = [oaddr, 0, 0];"),a.code.push("}"),a.code.push("else if (otype >= 0xC0 && otype <= 0xDF) {");var Ce=0;if(T.type==10||T.type==11){Ce=g(T.addr+4);for(var ge=0;ge<Ce;ge++)a.code.push("self.tempcallargs["+ge+"]="+g(T.addr+8+4*ge)+";")}a.code.push("self.enter_function(oaddr, "+Ce+");"),a.code.push("retval = true;"),a.code.push("}"),a.code.push("else {"),a.code.push("self.fatal_error('Unknown object while decoding string indirect reference.', otype);"),a.code.push("}");break;default:p("Unknown entity in string decoding (cached).");break}}}else{var K,ae,Se,fe=!1;for(u.stringtable||p("Attempted to print a compressed string with no table set."),ae=n(l),i&&(ae>>=i),K=g(u.stringtable+8);!fe;)switch(Se=n(K),K++,Se){case 0:ae&1?K=g(K+4):K=g(K+0),i==7?(i=0,l++,ae=n(l)):(i++,ae>>=1);break;case 1:t=!1,fe=!0;break;case 2:switch(h=n(K),e){case 2:a.buffer.push(xe(h));break;case 1:ue(a),V(a),P(a,"0x10,"+i,l),a.code.push("self.tempcallargs[0]="+h+";"),a.code.push("self.enter_function(self.iosysrock, 1);"),t=!0,fe=!0;break}K=g(u.stringtable+8);break;case 4:switch(h=g(K),e){case 2:a.buffer.push(xe(h));break;case 1:ue(a),V(a),P(a,"0x10,"+i,l),a.code.push("self.tempcallargs[0]="+h+";"),a.code.push("self.enter_function(self.iosysrock, 1);"),t=!0,fe=!0;break}K=g(u.stringtable+8);break;case 3:switch(e){case 2:for(;h=n(K),h!=0;)a.buffer.push(xe(h)),K++;break;case 1:ue(a),V(a),P(a,"0x10,"+i,l),t="["+K+", 0xE0, 0]",fe=!0;break}K=g(u.stringtable+8);break;case 5:switch(e){case 2:for(;h=g(K),h!=0;)a.buffer.push(xe(h)),K+=4;break;case 1:ue(a),V(a),P(a,"0x10,"+i,l),t="["+K+", 0xE2, 0]",fe=!0;break}K=g(u.stringtable+8);break;case 8:case 9:case 10:case 11:ue(a),V(a),a.code.push("var otype, retval;"),a.code.push("var oaddr = "+g(K)+";"),(Se==9||Se==11)&&a.code.push("oaddr = self.Mem4(oaddr);"),a.code.push("otype = self.Mem1(oaddr);"),t="retval",fe=!0,P(a,"0x10,"+i,l),a.code.push("if (otype >= 0xE0 && otype <= 0xFF) {"),a.code.push("retval = [oaddr, 0, 0];"),a.code.push("}"),a.code.push("else if (otype >= 0xC0 && otype <= 0xDF) {");var Ce=0;if(Se==10||Se==11){Ce=g(K+4);for(var ge=0;ge<Ce;ge++)a.code.push("self.tempcallargs["+ge+"]="+g(K+8+4*ge)+";")}a.code.push("self.enter_function(oaddr, "+Ce+");"),a.code.push("retval = true;"),a.code.push("}"),a.code.push("else {"),a.code.push("self.fatal_error('Unknown object while decoding string indirect reference.', otype);"),a.code.push("}");break;default:p("Unknown entity in string decoding.",Se);break}}else if(d==224){var h;switch(e){case 2:for(;h=n(l),l++,h!=0;)a.buffer.push(xe(h));break;case 1:ue(a),V(a),h=n(l),l++,h!=0?(P(a,"0x13,0",l),a.code.push("self.tempcallargs[0]="+h+";"),a.code.push("self.enter_function(self.iosysrock, 1);"),t=!0):t="false";break}}else if(d==226){var h;switch(e){case 2:for(;h=g(l),l+=4,h!=0;)a.buffer.push(xe(h));break;case 1:ue(a),V(a),h=g(l),l+=4,h!=0?(P(a,"0x14,0",l),a.code.push("self.tempcallargs[0]="+h+";"),a.code.push("self.enter_function(self.iosysrock, 1);"),t=!0):t="false";break}}else d>=224&&d<=255?p("Attempt to print unknown type of string."):p("Attempt to print non-string.");return t?(ue(a),a.code.push("return "+t+";"),tr(a.code.join(`
`),"_func_str_"+r,"nextcp","substring")):(a.code.length>1&&p("Simple-case string generated code."),a.buffer.join(""))}function Df(e,r){var f;switch(e){case 0:return 196867;case 1:return 131585;case 2:return 1;case 3:return 1;case 4:switch(r){case 0:return 1;case 1:return 1;case 2:return 1;default:return 0}break;case 5:return 1;case 6:return 1;case 7:return 1;case 8:return us();case 9:return 1;case 10:return oe[r]?1:0;case 11:return 1;case 12:return 1;case 13:return 1;default:return 0}}u.do_gestalt=Df;function Ar(e,r,f){var s;if(f&1)return ce(e,r);switch(r){case 4:return[e>>24&255,e>>16&255,e>>8&255,e&255];case 2:return[e>>8&255,e&255];case 1:return[e&255];default:p("Direct search key must hold one, two, or four bytes.")}}function Qf(e,r,f,s,l,i,t){var h,d,a,F,j=(t&4)!=0,E=(t&2)!=0,Q=Ar(e,r,t);for(d=0;d<l;d++,f+=s){for(a=!0,F=ce(f+i,r),h=0;a&&h<r;h++)F[h]!=Q[h]&&(a=!1);if(a)return j?d:f;if(E){for(a=!0,F=ce(f+i,r),h=0;a&&h<r;h++)F[h]!=0&&(a=!1);if(a)break}}return j?4294967295:0}function Br(e,r,f,s,l,i,t){var h,d,a,F,j,E,Q,X,T=(t&4)!=0,fe=Ar(e,r,t);for(d=0,h=l;d<h;){for(j=0,F=h+d>>1,a=f+F*s,E=0;!j&&E<r;E++)Q=n(a+i+E),X=fe[E],Q<X?j=-1:Q>X&&(j=1);if(!j)return T?F:a;j<0?d=F+1:h=F}return T?4294967295:0}function Tf(e,r,f,s,l,i){for(var t,h,d,a=(i&2)!=0,F=Ar(e,r,i);f!=0;){for(d=!0,t=0;d&&t<r;t++)h=n(f+s+t),h!=F[t]&&(d=!1);if(d)return f;if(a){for(d=!0,t=0;d&&t<r;t++)h=n(f+s+t),h!=0&&(d=!1);if(d)break}f=g(f+l)}return 0}u.linear_search=Qf,u.binary_search=Br,u.linked_search=Tf;function mr(e){var r,f,s;return e&2147483648?(r=!0,e=e&2147483647):r=!1,e==0?r?-0:0:(e&2139095040)==2139095040?e&8388607?r?NaN:NaN:r?-1/0:1/0:(s=e>>23&255,s?f=(e&8388607|8388608)/8388608*Math.pow(2,s-127):f=(e&8388607)/8388608*Math.pow(2,-126),r?-f:f)}function Yr(e){var r,f,s,l,i;return isNaN(e)?2139095041:isFinite(e)?e==0?1/e<0?2147483648:0:(e<0?(i=!0,r=-e):(i=!1,r=e),l=Math.floor(Math.log(r)/Math.log(2)),s=r/Math.pow(2,l),l>=128||(l<-126?(s=s*Math.pow(2,126+l),l=0):l==0&&s==0||(l+=127,s-=1),s=s*8388608,f=s+.4999999999999999<<0,f>=8388608&&(f=0,l++,l>=255))?i?4286578688:2139095040:i?(2147483648|l<<23|f)>>>0:l<<23|f):e<0?4286578688:2139095040}function wr(e,r){var f,s,l,i,t;return e&2147483648?(f=!0,e=e&2147483647):f=!1,e==0&&r==0?f?-0:0:(l=e>>20&2047,i=e&1048575,t=r,l==2047?i==0&&t==0?f?-1/0:1/0:f?NaN:NaN:(s=t/4503599627370496+i/1048576,l?s=(s+1)*Math.pow(2,l-1023):s=s*Math.pow(2,-1022),f?-s:s))}function Kr(e){var r,f,s,l,i,t,h,d;if(isNaN(e))return{hi:2146959360,lo:1};if(!isFinite(e))return e<0?{hi:4293918720,lo:0}:{hi:2146435072,lo:0};if(e==0)return 1/e<0?{hi:2147483648,lo:0}:{hi:0,lo:0};if(e<0?(t=!0,r=-e):(t=!1,r=e),i=Math.floor(Math.log(r)/Math.log(2)),i==1024)i--;else if(i>=1024)return t?4286578688:2139095040;return l=r/Math.pow(2,i),.5<=l&&l<1?(l*=2,i--):l>=2?(l*=.5,i++):l==0&&(i=0),i<-1022?(l=l*Math.pow(2,1022+i),i=0):i==0&&l==0||(i+=1023,l-=1),l*=268435456,f=l<<0,l-=f,l*=16777216,s=l+.5<<0,s>>24&&(s=0,f++,f>>28&&(f=0,i++,i>=255))?t?4286578688:2139095040:(h=((t?2147483648:0)|i<<20|f>>8)>>>0,d=((f&255)<<24|s)>>>0,{hi:h,lo:d})}u.decode_float=mr,u.encode_float=Yr,u.decode_double=wr,u.encode_double=Kr;var J=null,He=null,ef=null,rf=null,ff=null,qr=null,y,W;u.frame=null,u.vm_started=!1,u.vm_stopped=!1,u.tempcallargs=null,u.tempglkargs=null,u.done_executing=null;var jr,gr,Ee,Re;u.random_func=null;var U,Ye,lr,Vf,sf,uf,Rf;u.pc=null,u.stringtable=null,u.endmem=null,u.protectstart=null,u.protectend=null,u.iosysmode=null,u.iosysrock=null,u.prevpc=null;var We;u.resumefuncop=null,u.resumevalue=null;var he,R,re,lf=0,af=0,nf=0,tf=0,hf=0,cf=0,of=0,Er=0;function If(){var e,r;J||p("There is no Glulx game file loaded.");var f=u.Glk.getlibrary("Dialog");if(u.vm_started=!0,u.resumefuncop=null,u.resumevalue=0,y=null,W=[],u.frame=null,u.pc=0,u.prevpc=0,J.length<36&&p("This is too short to be a valid Glulx file."),e=o(J,0),e!=1198290284&&p("This is not a valid Glulx file."),r=o(J,4),r<131072&&p("This Glulx file is too old a version to execute."),r>=197120&&p("This Glulx file is too new a version to execute."),U=o(J,8),Ye=o(J,12),lr=o(J,16),Vf=o(J,20),sf=o(J,24),uf=o(J,28),Rf=o(J,32),u.protectstart=0,u.protectend=0,(U<256||Ye<U||lr<Ye)&&p("The segment boundaries in the header are in an impossible order."),Ye!=J.length&&p("The game file length does not agree with the header."),u.done_executing=!1,jr={},gr={},Ee=void 0,Re=void 0,u.tempcallargs=Array(8),u.tempglkargs=Array(8),dr(0),u.endmem=lr,u.stringtable=0,We=[],he=0,R=[],re=[],qr&&f.autosave_write(He,null),ff&&!qr)try{var s=f.autosave_read(He);if(s){O("Found autosave..."),s.ram=Array.from(s.ram),$f(s);return}}catch(l){O("Autorestore failed, deleting it: "+c(l)),l.stack&&O(`JS stack dump C:
`+l.stack),f.autosave_write(He,null)}df()}function df(){var e;Qr();var r=Wr();y=null,y=J.slice(0,Ye),u.endmem=y.length,ir(lr,!1),Dr(r),W=[],u.frame=null,u.pc=0,u.prevpc=0,u.iosysmode=0,u.iosysrock=0,Nr(uf),Lr(sf,0)}u.vm_restart=df;function Uf(e){for(var r=[],f=0;f<e.length;){for(var s=0;f<e.length&&e[f]==0&&s<=255;)s++,f++;for(s>0&&(r.push(0),r.push(s-1));f<e.length&&e[f]!=0;)r.push(e[f]),f++}return r}function Of(e){for(var r=[],f=0;f<e.length;){var s=e[f++];if(s==0)for(var l=e[f++]+1,i=0;i<l;i++)r.push(0);else r.push(s)}return r}function _f(e){for(var r=[],f=0;f<e.length;f++){var s=e[f].key,l=e[f].chunk;s.length!=4&&p("Bad chunk ID (must be exactly 4 chars): "+s),l==null&&p("Missing chunk data: "+s),le(r,s),Y(r,l.length),r=r.concat(l),r.length&1&&r.push(0)}return r}function vf(e){for(var r={},f=0;f<e.length;){if(f+8>e.length){O("IFF chunk header is truncated");return}var s=Te(e,f,4),l=o(e,f+4);if(f+=8,f+l>e.length){O(s+" chunk is truncated ("+l+" bytes needed, "+(e.length-f)+" available");return}r[s]=e.slice(f,f+l),f+=l,f&1&&(f+=1)}return r}function Pf(e){y.length!=u.endmem&&p("Memory length was incorrect before save."),u.iosysmode!=2&&p("Streams are only available in Glk I/O system.");var r=u.GiDispa.class_obj_from_id("stream",e);if(!r)return!1;var f=[];f.push({key:"IFhd",chunk:J.slice(0,128)});for(var s=y.slice(U),l=U;l<J.length;l++)s[l-U]^=J[l];s=Uf(s),s.splice(0,0,0,0,0,0),ke(s,0,u.endmem),f.push({key:"CMem",chunk:s});var i=[];f.push({key:"Stks",chunk:i});for(var l=0;l<W.length;l++)cr(W[l],i);if(ar()){var t=[];f.push({key:"MAll",chunk:t}),Y(t,he),Y(t,R.length);for(var l=0;l<R.length;l++)Y(t,R[l].addr),Y(t,R[l].size)}var h=[];le(h,"IFZS"),h=h.concat(_f(f));var d=_f([{key:"FORM",chunk:h}]);return u.Glk.glk_put_buffer_stream(r,d),!0}function Zf(e){u.iosysmode!=2&&p("Streams are only available in Glk I/O system.");var r=u.GiDispa.class_obj_from_id("stream",e);if(!r)return!1;for(var f=new Array(0),s=new Array(1024),l=1;l>0;)l=u.Glk.glk_get_buffer_stream(r,s),f=f.concat(s.slice(0,l));if(f=vf(f),!f)return O("vm_restore failed: file is not Quetzal"),!1;if(f=f.FORM,!f||Te(f,0,4)!="IFZS")return O("vm_restore failed: file doesn't start with FORM/IFZS header"),!1;var i=vf(f.slice(4));if(!i.IFhd)return O("vm_restore failed: missing required IFhd chunk"),!1;for(var t=0;t<128;t++)if(i.IFhd[t]!=J[t])return O("vm_restore failed: this save image is for a different game"),!1;if(!i.CMem)return O("vm_restore failed: missing required CMem chunk"),!1;if(!i.Stks)return O("vm_restore failed: missing required Stks chunk"),!1;var h=Wr();Qr();var d=o(i.CMem,0),a=i.CMem.slice(4);for(a=Of(a);a.length<d-U;)a.push(0);ir(d,!1),y=J.slice(0,U).concat(a);for(var t=U;t<J.length;t++)y[t]^=J[t];y.length!=u.endmem&&p("Memory length was incorrect after restore.");var F=i.Stks;for(W=[];F.length;)u.frame=or(F),u.frame||p("vm_restore failed: bad stack frame"),W.unshift(u.frame);for(var t=0;t<W.length;t++)W[t].depth=t;u.frame=W[W.length-1];var j=i.MAll;if(j&&j.length>=8){he=o(j,0);for(var E=o(j,4),t=0;t<E;t++){var Q=o(j,8+8*t),X=o(j,12+8*t);R.push(new Le(Q,X))}R.sort(function(fe,De){return fe.addr-De.addr});for(var T=he,t=0;t<R.length;t++){var Q=R[t].addr,X=R[t].size;(Q<T||Q+X>u.endmem)&&p("vm_restore failed: corrupt dynamic heap"),Q>T&&re.push(new Le(T,Q-T)),T=Q+X}T<u.endmem&&re.push(new Le(T,u.endmem-T))}return pr(),Dr(h),!0}function Hf(e){var r=u.Glk.getlibrary("Dialog");if(e<0){r.autosave_write(He,null);return}var f=Ef();if(f){var s={},l=u.frame.valstack,i=l.length;l.push(e),f.argsop==8&&l.push(1),f.selop==8&&l.push(192),l.push(0,0,u.prevpc,u.frame.framestart),s.ram=y.slice(U),s.endmem=u.endmem,s.pc=u.pc,s.stack=[];for(var t=0;t<W.length;t++)cr(W[t],s.stack);if(ar()){s.heapstart=he,s.usedlist=[];for(var t=0;t<R.length;t++)s.usedlist.push(R[t].addr),s.usedlist.push(R[t].size)}l.length=i,s.stringtable=u.stringtable,s.iosysmode=u.iosysmode,s.iosysrock=u.iosysrock,s.protectstart=u.protectstart,s.protectend=u.protectend,u.random_func==Hr&&_e&&(s.srand_table=_e.slice(0),s.srand_index1=Ve,s.srand_index2=Je),s.accel_params=N.slice(0),s.accel_funcnum_map={};for(var h in ur)s.accel_funcnum_map[h]=ur[h];s.glk=u.Glk.save_allstate(),r.autosave_write(He,s)}}function $f(e){y=J.slice(0,Ye),y=y.slice(0,U).concat(e.ram),u.endmem=e.endmem,u.pc=e.pc,W=[];for(var r=e.stack.slice(0);r.length;){var f=or(r);f||p("vm_autorestore failed: bad stack frame"),W.unshift(f)}for(var s=0;s<W.length;s++)W[s].depth=s;if(u.frame=W[W.length-1],e.heapstart===void 0)he=0,R=[],re=[];else{he=e.heapstart,R=[];for(var l=0;l<e.usedlist.length;l+=2){var i=e.usedlist[l],t=e.usedlist[l+1];R.push(new Le(i,t))}R.sort(function(d,a){return d.addr-a.addr}),re=[];for(var h=he,s=0;s<R.length;s++){var i=R[s].addr,t=R[s].size;(i<h||i+t>u.endmem)&&p("vm_autorestore failed: corrupt dynamic heap"),i>h&&re.push(new Le(h,i-h)),h=i+t}h<u.endmem&&re.push(new Le(h,u.endmem-h))}pr(),Nr(e.stringtable),$r(e.iosysmode,e.iosysrock),u.protectstart=e.protectstart,u.protectend=e.protectend,e.srand_table===void 0?dr(0):(dr(1),_e=e.srand_table.slice(0),Ve=e.srand_index1,Je=e.srand_index2),N=e.accel_params.slice(0);for(var l in e.accel_funcnum_map)ur[l]=e.accel_funcnum_map[l],Sr[l]=u.accel_func_map[ur[l]];u.Glk.restore_allstate(e.glk),Cr(0)}function Jf(){y.length!=u.endmem&&p("Memory length was incorrect before saveundo.");var e={};e.ram=y.slice(U),e.endmem=u.endmem,e.pc=u.pc,e.stack=[];for(var r=0;r<W.length;r++)e.stack[r]=Ze(W[r]);e.heapstart=he,e.usedlist=R.slice(0),e.freelist=re.slice(0),We.push(e),We.length>10&&We.shift()}function Xf(){if(We.length==0)return!1;var e=We.pop(),r=Wr();return y=y.slice(0,U).concat(e.ram),u.endmem=e.endmem,W=e.stack,u.frame=W[W.length-1],u.pc=e.pc,he=e.heapstart,R=e.usedlist,re=e.freelist,Dr(r),y.length!=u.endmem&&p("Memory length was incorrect after undo."),pr(),!0}function Yf(){return We.length!=0}function Kf(){if(We.length!=0)var e=We.pop()}u.vm_save=Pf,u.vm_restore=Zf,u.vm_saveundo=Jf,u.vm_restoreundo=Xf,u.vm_hasundo=Yf,u.vm_discardundo=Kf;function ir(e,r){var f;if(e!=u.endmem){if(!r&&ar()&&p("Cannot resize Glulx memory space while heap is active."),e<lr&&p("Cannot resize Glulx memory space smaller than it started."),e&255&&p("Can only resize Glulx memory space to a 256-byte boundary."),y.length=e,e>u.endmem)for(f=u.endmem;f<e;f++)y[f]=0;u.endmem=e}}u.change_memsize=ir;function Wr(){if(u.protectstart>=u.protectend)return null;for(var e=u.protectend-u.protectstart,r={start:u.protectstart,end:u.protectend,len:e},f=y.slice(u.protectstart,u.protectend);f.length<e;)f.push(0);return r.mem=f,r}function Dr(e){if(e){var r,f,s=e.mem,l=e.start,i=e.end;for(i>u.endmem&&(i=u.endmem),r=0,f=l;f<i;r++,f++)y[f]=s[r]}}function es(){var e=J.length,r,f,s;if(e<256||e&255||e!=o(J,12))return 1;for(s=o(J,32),f=-s>>>0,r=0;r<e;r+=4)f=f+o(J,r)>>>0;return f!=s?1:0}u.perform_verify=es;function rs(){return He}function fs(){return u}function ss(){var e={game_image_length:J.length,total_execution_time:lf,total_function_calls:af,accel_function_calls:nf,total_path_calls:tf,paths_cached:hf,paths_compiled:cf,strings_cached:of,strings_compiled:Er};return e}function Qr(){he=0,R=[],re=[]}function ar(){return R.length>0}function us(){return he}function Le(e,r){this.addr=e,this.size=r,this.end=e+r}function Tr(e,r){for(var f=0,s=e.length;f<s;){var l=f+s>>1;e[l].addr<r?f=l+1:s=l}return f}function ls(e){ar()||(he=u.endmem);for(var r=0,f=re.length;r<f;r++){var s=re[r];if(s.size>=e){s.size>e?re[r]=new Le(s.addr+e,s.size-e):re.splice(r,1);var l=Tr(R,s.addr);return R.splice(l,0,new Le(s.addr,e)),s.addr}}var i=u.endmem,t=e+255&4294967040;return ir(u.endmem+t,!0),t>e&&re.push(new Le(i+e,t-e)),R.push(new Le(i,e)),i}u.heap_malloc=ls;function is(e){var r=Tr(R,e),f=R[r];if((!f||f.addr!=e)&&p("Tried to free non-existent block"),R.splice(r,1),R.length==0){ir(he,!0),Qr();return}r=Tr(re,e);var s=re[r];s&&s.addr==f.end&&(f=new Le(e,f.size+s.size),re.splice(r,1));var l=re[r-1];l&&l.end==f.addr&&(f=new Le(l.addr,l.size+f.size),re.splice(r-1,1),r-=1),re.splice(r,0,f)}u.heap_free=is;function pr(){if(!ar()){he!=0&&p("Heap inconsistency: heapstart nonzero"),R.length>0&&p("Heap inconsistency: usedlist nonempty"),re.length>0&&p("Heap inconsistency: usedlist nonempty");return}he==0&&p("Heap inconsistency: heapstart is zero");for(var e=he,r=0,f=0;r<R.length||f<re.length;){var s=R[r],l=re[f];s&&s.addr==e?(e+=s.size,r++):l&&l.addr==e?(e+=l.size,f++):p("Heap inconsistency: no block at address "+e)}e!=u.endmem&&p("Heap inconsistency: overrun at end of heap")}u.assert_heap_valid=pr;var Ie={map:{},functions:[],functionmap:{}};function as(){return Ie}function ns(){if(u.GiLoad){var e=u.GiLoad.get_debug_info();if(e){var r,f,s;if(!(e[0]==222&&e[1]==191&&e[2]==0&&e[3]==0)){O("Dbug chunk did not contain an (old-style) Inform gameinfo.dbg file");return}var l=e[4]<<8|e[5];for(f=6,r=!1;!r;){var i=e[f++];switch(i){case 0:case void 0:r=!0;break;case 1:var t=e[f++];for(s=f;e[f];)f++;var h=String.fromCharCode.apply(this,e.slice(s,f));for(f++,s=f;e[f];)f++;var d=String.fromCharCode.apply(this,e.slice(s,f));f++;break;case 2:for(s=f;e[f];)f++;var a=String.fromCharCode.apply(this,e.slice(s,f));f++;var E=e.slice(f,f+4);f+=4;var Q=e.slice(f,f+4);f+=4;break;case 3:var F=e[f++]<<8|e[f++];for(s=f;e[f];)f++;var j=String.fromCharCode.apply(this,e.slice(s,f));f++;var E=e.slice(f,f+4);f+=4;var Q=e.slice(f,f+4);f+=4;break;case 4:var X=e[f++];for(s=f;e[f];)f++;var ae=String.fromCharCode.apply(this,e.slice(s,f));f++;break;case 5:var X=e[f++]<<8|e[f++];for(s=f;e[f];)f++;var ae=String.fromCharCode.apply(this,e.slice(s,f));f++;break;case 6:var X=e[f++]<<8|e[f++];for(s=f;e[f];)f++;var ae=String.fromCharCode.apply(this,e.slice(s,f));f++;break;case 7:var X=e[f++]<<8|e[f++];for(s=f;e[f];)f++;var ae=String.fromCharCode.apply(this,e.slice(s,f));f++;break;case 8:var X=e[f++]<<8|e[f++];for(s=f;e[f];)f++;var ae=String.fromCharCode.apply(this,e.slice(s,f));f++;break;case 9:f+=64;break;case 10:var Ke=e[f++]<<8|e[f++],T=e[f++]<<8|e[f++];f+=T*6;break;case 11:var Ke=e[f++]<<8|e[f++],Vr=e.slice(f,f+4);f+=4;var fe=e[f++]<<16|e[f++]<<8|e[f++];for(s=f;e[f];)f++;var De=String.fromCharCode.apply(this,e.slice(s,f));f++;for(var Ce=[];e[f];){for(s=f;e[f];)f++;var ge=String.fromCharCode.apply(this,e.slice(s,f));f++,Ce.push(ge)}f++,Ie.functions.push({num:Ke,name:De,addr:fe,locals:Ce});break;case 12:var K=e[f++]<<8|e[f++];for(s=f;e[f];)f++;var ae=String.fromCharCode.apply(this,e.slice(s,f));f++;break;case 13:for(;e[f];){for(s=f;e[f];)f++;var ae=String.fromCharCode.apply(this,e.slice(s,f));f++;var Se=e[f++]<<16|e[f++]<<8|e[f++];Ie.map[ae]=Se}f++;break;case 14:var Ke=e[f++]<<8|e[f++],Vr=e.slice(f,f+4);f+=4;var wf=e[f++]<<16|e[f++]<<8|e[f++];break;default:O("Unknown record type in debug data: "+i),r=!0;break}}var br=Ie.map["code area"];if(br){var er;for(er=0;er<Ie.functions.length;er++){var $e=Ie.functions[er];Ie.functionmap[br+$e.addr]=$e}}}}}u.VMStopped={dummy:"The top-level function has returned."};function mf(){var e,r,f,s,l;for(u.resumefuncop&&(jf(u.resumefuncop,u.resumevalue),u.resumefuncop=null,u.resumevalue=0),s=new Date().getTime();!u.done_executing;){e=u.frame.vmfunc,r=e[u.iosysmode],f=r[u.pc],f===void 0&&(e.pathaddrs[u.pc]=!0,f=Nf(e,u.pc,u.iosysmode),cf++,u.pc<U&&(r[u.pc]=f,hf++)),tf++;var i=f(u);i===u.VMStopped&&(u.done_executing=!0,u.vm_stopped=!0)}l=new Date().getTime(),lf+=(l-s)/1e3,u.vm_stopped&&u.Glk.glk_exit(),u.Glk.update(),ef&&O("event executed in "+(l-s)+" ms")}return{classname:"Quixe",version:"2.2.1",init:D,inited:pe,getlibrary:ne,start:be,resume:_,get_signature:rs,get_vm_internals:fs,get_statistics:ss,get_debuginfo:as,ReadByte:ye,WriteByte:me,ReadWord:kr,WriteWord:Ue,ReadStructField:Fe,WriteStructField:Oe,SetResumeStore:yr,do_autosave:Hf}},gs=new kf;try{Pr.Quixe=gs,Pr.QuixeClass=kf}catch{}});var xf=Ur(Ff=>{"use strict";var ps=function(){var u={};u.VM=null,u.Glk=null;function D(m){u.VM=m.vm,u.Glk=m.io}function pe(){return u.VM!=null}function ne(m){switch(m){case"VM":return u.VM;case"Glk":return u.Glk}return null}var be={0:"window",1:"stream",2:"fileref",3:"schannel"};function _(m,w,M){this.id=m,this.name=w,this.proto=M}function c(m,w){this.args=m,this.retarg=w}function O(){this.macro="Byte",this.refsize=1,this.serialize=function(){return{type:"ArgString"}}}function ve(){this.macro="Word",this.refsize=4,this.serialize=function(){return{type:"ArgUnicode"}}}function se(m){this.signed=m,this.macro="Byte",this.refsize=1,this.literal=m?"arg_char_signed":"arg_char_unsigned",this.serialize=function(){return{type:"ArgChar",signed:m}}}function Z(m){this.signed=m,this.macro="Word",this.refsize=4,this.literal=m?"arg_int_signed":"arg_int_unsigned",this.serialize=function(){return{type:"ArgInt",signed:m}}}function de(m){this.name=m,this.macro="Word",this.refsize=4}function x(m){this.form=m}function o(m,w,M,B){this.arg=m,this.passin=w,this.passout=M,this.nonnull=B}function A(m,w,M,B,P){this.arg=m,this.retained=w,this.passin=M,this.passout=B,this.nonnull=P}function H(m){switch(m.type){case"ArgString":return new O;case"ArgUnicode":return new ve;case"ArgInt":return m.signed?v:n;case"ArgChar":return m.signed===null?ce:m.signed?Ae:g}throw new Error("arg_deserialize: unknown type: "+m.type)}var n=new Z(!1),v=new Z(!0),g=new se(!1),ce=new se(null),Ae=new se(!0),S=new de("window"),q=new de("stream"),le=new de("fileref"),Y=new de("schannel"),Qe={1:new _(1,"exit",new c([],null)),3:new _(3,"tick",new c([],null)),4:new _(4,"gestalt",new c([n,n],new o(n,!1,!0,!0))),5:new _(5,"gestalt_ext",new c([n,n,new A(n,!1,!0,!0,!1)],new o(n,!1,!0,!0))),32:new _(32,"window_iterate",new c([S,new o(n,!1,!0,!1)],new o(S,!1,!0,!0))),33:new _(33,"window_get_rock",new c([S],new o(n,!1,!0,!0))),34:new _(34,"window_get_root",new c([],new o(S,!1,!0,!0))),35:new _(35,"window_open",new c([S,n,n,n,n],new o(S,!1,!0,!0))),36:new _(36,"window_close",new c([S,new o(new x(new c([n,n],null)),!1,!0,!1)],null)),37:new _(37,"window_get_size",new c([S,new o(n,!1,!0,!1),new o(n,!1,!0,!1)],null)),38:new _(38,"window_set_arrangement",new c([S,n,n,S],null)),39:new _(39,"window_get_arrangement",new c([S,new o(n,!1,!0,!1),new o(n,!1,!0,!1),new o(S,!1,!0,!1)],null)),40:new _(40,"window_get_type",new c([S],new o(n,!1,!0,!0))),41:new _(41,"window_get_parent",new c([S],new o(S,!1,!0,!0))),42:new _(42,"window_clear",new c([S],null)),43:new _(43,"window_move_cursor",new c([S,n,n],null)),44:new _(44,"window_get_stream",new c([S],new o(q,!1,!0,!0))),45:new _(45,"window_set_echo_stream",new c([S,q],null)),46:new _(46,"window_get_echo_stream",new c([S],new o(q,!1,!0,!0))),47:new _(47,"set_window",new c([S],null)),48:new _(48,"window_get_sibling",new c([S],new o(S,!1,!0,!0))),64:new _(64,"stream_iterate",new c([q,new o(n,!1,!0,!1)],new o(q,!1,!0,!0))),65:new _(65,"stream_get_rock",new c([q],new o(n,!1,!0,!0))),66:new _(66,"stream_open_file",new c([le,n,n],new o(q,!1,!0,!0))),67:new _(67,"stream_open_memory",new c([new A(ce,!0,!0,!0,!1),n,n],new o(q,!1,!0,!0))),68:new _(68,"stream_close",new c([q,new o(new x(new c([n,n],null)),!1,!0,!1)],null)),69:new _(69,"stream_set_position",new c([q,v,n],null)),70:new _(70,"stream_get_position",new c([q],new o(n,!1,!0,!0))),71:new _(71,"stream_set_current",new c([q],null)),72:new _(72,"stream_get_current",new c([],new o(q,!1,!0,!0))),73:new _(73,"stream_open_resource",new c([n,n],new o(q,!1,!0,!0))),96:new _(96,"fileref_create_temp",new c([n,n],new o(le,!1,!0,!0))),97:new _(97,"fileref_create_by_name",new c([n,new O,n],new o(le,!1,!0,!0))),98:new _(98,"fileref_create_by_prompt",new c([n,n,n],new o(le,!1,!0,!0))),99:new _(99,"fileref_destroy",new c([le],null)),100:new _(100,"fileref_iterate",new c([le,new o(n,!1,!0,!1)],new o(le,!1,!0,!0))),101:new _(101,"fileref_get_rock",new c([le],new o(n,!1,!0,!0))),102:new _(102,"fileref_delete_file",new c([le],null)),103:new _(103,"fileref_does_file_exist",new c([le],new o(n,!1,!0,!0))),104:new _(104,"fileref_create_from_fileref",new c([n,le,n],new o(le,!1,!0,!0))),128:new _(128,"put_char",new c([g],null)),129:new _(129,"put_char_stream",new c([q,g],null)),130:new _(130,"put_string",new c([new O],null)),131:new _(131,"put_string_stream",new c([q,new O],null)),132:new _(132,"put_buffer",new c([new A(ce,!1,!0,!1,!0)],null)),133:new _(133,"put_buffer_stream",new c([q,new A(ce,!1,!0,!1,!0)],null)),134:new _(134,"set_style",new c([n],null)),135:new _(135,"set_style_stream",new c([q,n],null)),144:new _(144,"get_char_stream",new c([q],new o(v,!1,!0,!0))),145:new _(145,"get_line_stream",new c([q,new A(ce,!1,!1,!0,!0)],new o(n,!1,!0,!0))),146:new _(146,"get_buffer_stream",new c([q,new A(ce,!1,!1,!0,!0)],new o(n,!1,!0,!0))),160:new _(160,"char_to_lower",new c([g],new o(g,!1,!0,!0))),161:new _(161,"char_to_upper",new c([g],new o(g,!1,!0,!0))),176:new _(176,"stylehint_set",new c([n,n,n,v],null)),177:new _(177,"stylehint_clear",new c([n,n,n],null)),178:new _(178,"style_distinguish",new c([S,n,n],new o(n,!1,!0,!0))),179:new _(179,"style_measure",new c([S,n,n,new o(n,!1,!0,!1)],new o(n,!1,!0,!0))),192:new _(192,"select",new c([new o(new x(new c([n,S,n,n],null)),!1,!0,!0)],null)),193:new _(193,"select_poll",new c([new o(new x(new c([n,S,n,n],null)),!1,!0,!0)],null)),208:new _(208,"request_line_event",new c([S,new A(ce,!0,!0,!0,!0),n],null)),209:new _(209,"cancel_line_event",new c([S,new o(new x(new c([n,S,n,n],null)),!1,!0,!1)],null)),210:new _(210,"request_char_event",new c([S],null)),211:new _(211,"cancel_char_event",new c([S],null)),212:new _(212,"request_mouse_event",new c([S],null)),213:new _(213,"cancel_mouse_event",new c([S],null)),214:new _(214,"request_timer_events",new c([n],null)),224:new _(224,"image_get_info",new c([n,new o(n,!1,!0,!1),new o(n,!1,!0,!1)],new o(n,!1,!0,!0))),225:new _(225,"image_draw",new c([S,n,v,v],new o(n,!1,!0,!0))),226:new _(226,"image_draw_scaled",new c([S,n,v,v,n,n],new o(n,!1,!0,!0))),232:new _(232,"window_flow_break",new c([S],null)),233:new _(233,"window_erase_rect",new c([S,v,v,n,n],null)),234:new _(234,"window_fill_rect",new c([S,n,v,v,n,n],null)),235:new _(235,"window_set_background_color",new c([S,n],null)),240:new _(240,"schannel_iterate",new c([Y,new o(n,!1,!0,!1)],new o(Y,!1,!0,!0))),241:new _(241,"schannel_get_rock",new c([Y],new o(n,!1,!0,!0))),242:new _(242,"schannel_create",new c([n],new o(Y,!1,!0,!0))),243:new _(243,"schannel_destroy",new c([Y],null)),244:new _(244,"schannel_create_ext",new c([n,n],new o(Y,!1,!0,!0))),247:new _(247,"schannel_play_multi",new c([new A(Y,!1,!0,!1,!0),new A(n,!1,!0,!1,!0),n],new o(n,!1,!0,!0))),248:new _(248,"schannel_play",new c([Y,n],new o(n,!1,!0,!0))),249:new _(249,"schannel_play_ext",new c([Y,n,n,n],new o(n,!1,!0,!0))),250:new _(250,"schannel_stop",new c([Y],null)),251:new _(251,"schannel_set_volume",new c([Y,n],null)),252:new _(252,"sound_load_hint",new c([n,n],null)),253:new _(253,"schannel_set_volume_ext",new c([Y,n,n,n],null)),254:new _(254,"schannel_pause",new c([Y],null)),255:new _(255,"schannel_unpause",new c([Y],null)),256:new _(256,"set_hyperlink",new c([n],null)),257:new _(257,"set_hyperlink_stream",new c([q,n],null)),258:new _(258,"request_hyperlink_event",new c([S],null)),259:new _(259,"cancel_hyperlink_event",new c([S],null)),288:new _(288,"buffer_to_lower_case_uni",new c([new A(n,!1,!0,!0,!0),n],new o(n,!1,!0,!0))),289:new _(289,"buffer_to_upper_case_uni",new c([new A(n,!1,!0,!0,!0),n],new o(n,!1,!0,!0))),290:new _(290,"buffer_to_title_case_uni",new c([new A(n,!1,!0,!0,!0),n,n],new o(n,!1,!0,!0))),291:new _(291,"buffer_canon_decompose_uni",new c([new A(n,!1,!0,!0,!0),n],new o(n,!1,!0,!0))),292:new _(292,"buffer_canon_normalize_uni",new c([new A(n,!1,!0,!0,!0),n],new o(n,!1,!0,!0))),296:new _(296,"put_char_uni",new c([n],null)),297:new _(297,"put_string_uni",new c([new ve],null)),298:new _(298,"put_buffer_uni",new c([new A(n,!1,!0,!1,!0)],null)),299:new _(299,"put_char_stream_uni",new c([q,n],null)),300:new _(300,"put_string_stream_uni",new c([q,new ve],null)),301:new _(301,"put_buffer_stream_uni",new c([q,new A(n,!1,!0,!1,!0)],null)),304:new _(304,"get_char_stream_uni",new c([q],new o(v,!1,!0,!0))),305:new _(305,"get_buffer_stream_uni",new c([q,new A(n,!1,!1,!0,!0)],new o(n,!1,!0,!0))),306:new _(306,"get_line_stream_uni",new c([q,new A(n,!1,!1,!0,!0)],new o(n,!1,!0,!0))),312:new _(312,"stream_open_file_uni",new c([le,n,n],new o(q,!1,!0,!0))),313:new _(313,"stream_open_memory_uni",new c([new A(n,!0,!0,!0,!1),n,n],new o(q,!1,!0,!0))),314:new _(314,"stream_open_resource_uni",new c([n,n],new o(q,!1,!0,!0))),320:new _(320,"request_char_event_uni",new c([S],null)),321:new _(321,"request_line_event_uni",new c([S,new A(n,!0,!0,!0,!0),n],null)),336:new _(336,"set_echo_line_event",new c([S,n],null)),337:new _(337,"set_terminators_line_event",new c([S,new A(n,!1,!0,!1,!1)],null)),352:new _(352,"current_time",new c([new o(new x(new c([v,n,v],null)),!1,!0,!0)],null)),353:new _(353,"current_simple_time",new c([n],new o(v,!1,!0,!0))),360:new _(360,"time_to_date_utc",new c([new o(new x(new c([v,n,v],null)),!0,!1,!0),new o(new x(new c([v,v,v,v,v,v,v,v],null)),!1,!0,!0)],null)),361:new _(361,"time_to_date_local",new c([new o(new x(new c([v,n,v],null)),!0,!1,!0),new o(new x(new c([v,v,v,v,v,v,v,v],null)),!1,!0,!0)],null)),362:new _(362,"simple_time_to_date_utc",new c([v,n,new o(new x(new c([v,v,v,v,v,v,v,v],null)),!1,!0,!0)],null)),363:new _(363,"simple_time_to_date_local",new c([v,n,new o(new x(new c([v,v,v,v,v,v,v,v],null)),!1,!0,!0)],null)),364:new _(364,"date_to_time_utc",new c([new o(new x(new c([v,v,v,v,v,v,v,v],null)),!0,!1,!0),new o(new x(new c([v,n,v],null)),!1,!0,!0)],null)),365:new _(365,"date_to_time_local",new c([new o(new x(new c([v,v,v,v,v,v,v,v],null)),!0,!1,!0),new o(new x(new c([v,n,v],null)),!1,!0,!0)],null)),366:new _(366,"date_to_simple_time_utc",new c([new o(new x(new c([v,v,v,v,v,v,v,v],null)),!0,!1,!0),n],new o(v,!1,!0,!0))),367:new _(367,"date_to_simple_time_local",new c([new o(new x(new c([v,v,v,v,v,v,v,v],null)),!0,!1,!0),n],new o(v,!1,!0,!0))),4352:new _(4352,"garglk_set_zcolors",new c([n,n],null)),4353:new _(4353,"garglk_set_zcolors_stream",new c([q,n,n],null)),4354:new _(4354,"garglk_set_reversevideo",new c([n],null)),4355:new _(4355,"garglk_set_reversevideo_stream",new c([q,n],null))};u.arg_int_unsigned=n,u.arg_int_signed=v,u.arg_char_unsigned=g,u.arg_char_native=ce,u.arg_char_signed=Ae;function Be(m,w,M){return m instanceof Z?w?m.signed?M+" & 0xFFFFFFFF":M:"0":m instanceof se?w?m.signed?"self.cast_signed_char("+M+")":M+" & 0xFF":"0":m instanceof de?w?'self.class_obj_from_id("'+m.name+'", '+M+")":"null":"???"}function ke(m,w){return m instanceof Z?w+" >>> 0":m instanceof se?m.signed?"self.uncast_signed_char("+w+")":w+" & 0xFF":m instanceof de?'self.class_obj_to_id("'+m.name+'", '+w+")":"???"}function Te(m){return m=m&255,m&128&&(m-=256),m}u.cast_signed_char=Te;function Ge(m){return m=m&255,m&128&&(m+=4294967040),m}u.uncast_signed_char=Ge;function ze(m,w){return w?w.disprock:0}u.class_obj_to_id=ze;function ie(m,w){return w==0||!w?null:qe[m][w]}u.class_obj_from_id=ie;function ye(m){var w,M,B,P,V,I,ue,L,k,b,z,rr,ee,je,C=[],te={},fr=0;for(C.push("// no local vars"),C.push("// "+m.id+": "+m.name),B=m.proto,P=null,B.retarg&&(P=B.retarg.arg),C.push("var self = this;"),je=u.Glk.call_may_not_return(m.id),V=0,I=[],w=0;w<B.args.length;w++)if(L=B.args[w],b="glka"+w,I.push(b),te[b]=!0,L instanceof Z||L instanceof se||L instanceof de)z=Be(L,!0,"callargs["+V+"]"),C.push(b+" = "+z+";"),V+=1;else if(L instanceof o){if(k=L.arg,C.push("if (callargs["+V+"] == 0) {"),L.nonnull?C.push('  throw new Error("glk '+m.name+': null argument");'):C.push("  "+b+" = null;"),C.push("} else {"),k instanceof Z||k instanceof se||k instanceof de)C.push("  "+b+" = new self.Glk.RefBox();"),z=Be(k,L.passin,"self.VM.ReadWord(callargs["+V+"])"),C.push("  "+b+".set_value("+z+");");else if(k instanceof x)for(ue=k.form.args,C.push("  "+b+" = new self.Glk.RefStruct("+ue.length+");"),M=0;M<ue.length;M++)z=Be(ue[M],L.passin,"self.VM.ReadStructField(callargs["+V+"], "+M+")"),C.push("  "+b+".push_field("+z+");");else throw new Error("buildfunc: unsupported refarg type: "+m.name);C.push("}"),V+=1}else if(L instanceof A)te.glklen=!0,k=L.arg,C.push("if (callargs["+V+"] == 0) {"),L.nonnull?C.push('  throw new Error("glk '+m.name+': null argument");'):C.push("  "+b+" = null;"),C.push("} else {"),C.push("  glklen = callargs["+(V+1)+"];"),C.push("  "+b+" = Array(glklen);"),L.passin&&(te.ix=!0,te.jx=!0,C.push("  for (ix=0, jx=callargs["+V+"]; ix<glklen; ix++, jx+="+k.refsize+") {"),z=Be(k,!0,"self.VM.Read"+k.macro+"(jx)"),C.push("    "+b+"[ix] = "+z+";"),C.push("  }")),L.retained&&(fr==0&&C.push("  self.temp_arg_arrays.length = 0;"),fr+=1,C.push("  self.make_arg_array("+b+", callargs["+V+"], glklen, self."+k.literal+");")),C.push("}"),V+=2;else if(L instanceof O||L instanceof ve){te.ix=!0,te.jx=!0;var G,sr;L instanceof O?(sr="0xE0",G="byte_array_to_string"):(sr="0xE2",G="uni_array_to_string"),C.push(b+" = Array();"),C.push("jx = callargs["+V+"];"),C.push("if (self.VM.ReadByte(jx) != "+sr+') throw new Error("glk '+m.name+': string argument must be unencoded");'),C.push("for (jx+="+L.refsize+"; true; jx+="+L.refsize+") {"),C.push("  ix = self.VM.Read"+L.macro+"(jx);"),C.push("  if (ix == 0) break;"),C.push("  "+b+".push(ix);"),C.push("}"),C.push(b+" = self.Glk."+G+"("+b+");"),V+=1}else throw new Error("buildfunc: unsupported arg type: "+m.name);for(C.push("if (callargs.length != "+V+') throw "glk '+m.name+': wrong number of arguments";'),P||je?(te.glkret=!0,rr="glkret = "):rr="",C.push(rr+("self.Glk.glk_"+m.name).replace("glk_gar","gar")+"("+I.join(", ")+");"),je&&(C.push("if (glkret === self.Glk.DidNotReturn) {"),C.push("  self.set_blocked_selector("+m.id+", callargs);"),C.push("  return glkret;"),C.push("}")),V=0,w=0;w<B.args.length;w++)if(L=B.args[w],b="glka"+w,L instanceof Z||L instanceof se||L instanceof de)V+=1;else if(L instanceof o){if(k=L.arg,L.passout){if(C.push("if ("+b+") {"),k instanceof Z||k instanceof se||k instanceof de)z=ke(k,b+".get_value()"),C.push("  self.VM.WriteWord(callargs["+V+"], "+z+");");else if(k instanceof x)for(ue=k.form.args,M=0;M<ue.length;M++)z=ke(ue[M],b+".get_field("+M+")"),C.push("  self.VM.WriteStructField(callargs["+V+"], "+M+", "+z+");");else throw new Error("buildfunc: unsupported refarg type: "+m.name);C.push("}")}V+=1}else if(L instanceof A)k=L.arg,L.passout&&!L.retained&&(C.push("if ("+b+") {"),te.ix=!0,te.jx=!0,C.push("  for (ix=0, jx=callargs["+V+"]; ix<glklen; ix++, jx+="+k.refsize+") {"),z=ke(k,b+"[ix]"),C.push("    self.VM.Write"+k.macro+"(jx, "+z+")"),C.push("  }"),C.push("}")),V+=2;else if(L instanceof O||L instanceof ve)V+=1;else throw new Error("buildfunc: unsupported arg type: "+m.name);fr!=0&&C.push("self.temp_arg_arrays.length = 0;"),P?(z=ke(P,"glkret"),C.push("return "+z+";")):C.push("return 0;"),ee=[];for(z in te)ee.push(z);ee.length&&(C[0]="var "+ee.join(", ")+";"),z=C.join(`
`);var Mr=new Function("callargs",z);return Mr.bind(u)}var me={};function kr(m){var w,M=me[m];if(M===void 0){if(w=Qe[m],w===void 0)throw new Error("dispatch: unknown Glk function: "+m);M=ye(w),me[m]=M}return M}var Ue=null,Fe=null,Oe=-1;function yr(m,w){Ue=m,Fe=w.slice(0)}u.set_blocked_selector=yr;function xe(){return Ue==192&&Fe&&Fe.length>0&&(Oe==2||Oe==3||Oe==4||Oe==8)?Fe[0]:null}function Fr(m){Ue==192?Fe[0]!=0&&(Oe=m.get_field(0)>>>0,u.VM.WriteStructField(Fe[0],0,m.get_field(0)>>>0),u.VM.WriteStructField(Fe[0],1,ze("window",m.get_field(1))),u.VM.WriteStructField(Fe[0],2,m.get_field(2)>>>0),u.VM.WriteStructField(Fe[0],3,m.get_field(3)>>>0)):Ue==98&&u.VM.SetResumeStore(ze("fileref",m)),Ue=null,Fe=null}var Pe=[];u.temp_arg_arrays=Pe;var we=[];u.retained_arrays=we;function nr(m,w,M,B){var P;m&&(P={arr:m,addr:w,len:M,arg:B},Pe.push(P))}u.make_arg_array=nr;function p(m,w){var M,B;if(m){if(w!==void 0){if(m!==w.arr)throw new Error("retain_array: array does not match useobj");if(B={addr:w.addr,len:w.len,arr:m,arg:H(w.arg)},B.len!=m.length)throw new Error("retain_array: array length from useobj does not match")}else for(B=void 0,M=0;M<Pe.length;M++)if(Pe[M].arr===m){B=Pe[M];break}if(B===void 0)throw new Error("retain_array: array is not an argument");for(M=0;we[M]!==void 0;M++);we[M]=B}}function tr(m){var w;for(w=0;w<we.length;w++)if(we[w]!==void 0&&we[w].arr===m)return we[w];return null}function hr(m){var w,M,B;if(m){for(B=void 0,w=0;w<we.length;w++)if(we[w]!==void 0&&we[w].arr===m){B=we[w],delete we[w];break}if(B===void 0)throw new Error("unretain_array: array was never retained");if(B.arg instanceof Z)for(w=0,M=B.addr;w<B.len;w++,M+=4)u.VM.WriteWord(M,B.arr[w]>>>0);else if(B.arg instanceof se)if(B.arg.signed)for(w=0,M=B.addr;w<B.len;w++,M++)u.VM.WriteByte(M,Ge(B.arr[w]));else for(w=0,M=B.addr;w<B.len;w++,M++)u.VM.WriteByte(M,B.arr[w]&255);else throw new Error("unretain_array: unsupported refarg type")}}var qe={},Ze;function cr(m,w,M){if(M===void 0){if(w.disprock)throw new Error("class_register: object is already registered");w.disprock=Ze,Ze++}else{if(w.disprock!=M)throw new Error("class_register: object is not already registered");Ze<=M&&(Ze=M+1)}qe[m][w.disprock]=w}function or(m,w){if(!w.disprock||qe[m][w.disprock]===void 0)throw new Error("class_unregister: object is not registered");delete qe[m][w.disprock],w.disprock=void 0}function xr(){var m,w;Ze=1+Math.round(Math.random()*1e3);for(m in be)w=be[m],qe[w]={}}return xr(),{classname:"GiDispa",init:D,inited:pe,getlibrary:ne,get_function:kr,prepare_resume:Fr,check_autosave:xe,class_register:cr,class_unregister:or,class_obj_to_id:ze,class_obj_from_id:ie,retain_array:p,unretain_array:hr,get_retained_array:tr}};try{Ff.GiDispaClass=ps}catch{}});var Lf=Ur(Zr=>{"use strict";var Mf=function(){var u={vm:null,io:null,spacing:4,use_query_story:!0,default_story:null,set_page_title:!0,default_page_title:"Game",game_format_name:"",exit_warning:"The game session has ended.",resources:null,image_info_map:null,proxy_url:"https://zcode.appspot.com/proxy/"},D=null,pe=!1,ne=null;function be(x,o,A){A?typeof A=="string"&&(A={format:A}):A={};var H=A.format;if(H||(H="array"),u.io=window.Glk,u.vm=window.Quixe,u.GiLoad=this,u.GlkOte=null,u.GiDispa=null,u.Blorb=null,x||(x=window.game_options),x&&window.Quixe&&(!x.vm||x.vm===window.Quixe)&&(u.engine_name="Quixe",u.blorb_gamechunk_type="GLUL",u.game_format_name="Glulx"),x&&jQuery.extend(u,x),!u.GlkOte&&window.GlkOteClass&&(u.GlkOte=new window.GlkOteClass),!u.GiDispa&&window.GiDispaClass&&(u.GiDispa=new window.GiDispaClass),!u.Blorb&&window.BlorbClass&&(u.Blorb=new window.BlorbClass),ne=u.GlkOte,u.resources!=null&&jQuery.type(u.resources)==="string"&&(window[u.resources]?u.resources=window[u.resources]:delete u.resources),u.image_info_map!=null&&jQuery.type(u.image_info_map)==="string"&&(window[u.image_info_map]?u.image_info_map=window[u.image_info_map]:delete u.image_info_map),D=null,u.use_query_story){var n=_();D=n.story}if(!D&&o){switch(ne.log("GiLoad: trying pre-loaded load ("+H+")..."),H){case"base64":o=ve(o);break;case"raw":o=O(o);break;case"array":break;default:u.io.fatal_error("Could not decode story file data: "+H);return}se(o);return}if(D||(D=u.default_story),!D){u.io.fatal_error("No story file specified!");return}o=null;var v=new XMLHttpRequest,g=v.overrideMimeType!==void 0,ce=v.withCredentials!==void 0;v=null;var Ae=/^(file:|(\w+:)?\/\/[^\/?#]+)/,S=Ae.exec(location)[0],q=Ae.exec(D),le=!q,Y=q?q[0]:S,Qe=S==Y;navigator.userAgent.match(/chrome/i)&&Y=="file:"&&(Qe=!1);var Be=D.match(/[.]js$/i);if(ne.log("GiLoad: is_relative="+le+", same_origin="+Qe+", binary_supported="+g+", crossorigin_supported="+ce),Be&&Qe){ne.log("GiLoad: trying old-fashioned load..."),window.processBase64Zcode=function(ie){se(ve(ie))},jQuery.ajax(D,{type:"GET",dataType:"script",cache:!0,error:function(ie,ye,me){u.io.fatal_error("The story could not be loaded. ("+D+"): Error "+ye+": "+me)}});return}if(Be){ne.log("GiLoad: trying script load..."),window.processBase64Zcode=function(ie){se(ve(ie))};var ke=$("head");if(!ke.length){u.io.fatal_error("This page has no <head> element!");return}var Te=$("<script>",{src:D,type:"text/javascript"});ke.get(0).appendChild(Te.get(0));return}if(g&&Qe){ne.log("GiLoad: trying binary load..."),jQuery.ajax(D,{type:"GET",beforeSend:function(ie,ye){ie.overrideMimeType("text/plain; charset=x-user-defined")},success:function(ie,ye,me){se(O(ie))},error:function(ie,ye,me){u.io.fatal_error("The story could not be loaded. ("+D+"): Error "+ye+": "+me)}});return}if(Y=="file:"){u.io.fatal_error("The story could not be loaded. ("+D+"): A local file cannot be sent to the proxy.");return}var Ge=D;if(le&&(Ge=c(D),ne.log("GiLoad: absolutize "+D+" to "+Ge)),ce){ne.log("GiLoad: trying proxy load... ("+u.proxy_url+")"),jQuery.ajax(u.proxy_url,{type:"GET",data:{encode:"base64",url:Ge},error:function(ie,ye,me){u.io.fatal_error("The story could not be loaded. ("+D+"): Error "+ye+": "+me)},success:function(ie,ye,me){se(ve(ie))}});return}var ze=u.proxy_url+"?encode=base64&callback=processBase64Zcode&url="+Ge;ne.log("GiLoad: trying proxy-script load... ("+ze+")"),window.processBase64Zcode=function(me){se(ve(me))};var ke=$("head");if(!ke.length){u.io.fatal_error("This page has no <head> element!");return}var Te=$("<script>",{src:ze,type:"text/javascript"});ke.append(Te)}function _(){var x={},o=location.search.substring(1,location.search.length);if(o.length){var A=o.split("&");o=o.replace(/\+/g," ");for(var H=0;H<A.length;H++){var n=A[H].split("="),v=decodeURIComponent(n[0]),g=n.length==2?decodeURIComponent(n[1]):v;x[v]=g}}return x}function c(x){var o=new URL(x,document.location.href);return o.href}function O(x){var o=Array(x.length),A;for(A=0;A<x.length;A++)o[A]=x.charCodeAt(A)&255;return o}function ve(x){var o=atob(x),A=Array(o.length),H;for(H=0;H<o.length;H++)A[H]=o.charCodeAt(H);return A}function se(x){if(x.length==0){u.io.fatal_error("No game file was loaded. (Zero-length response.)");return}if(x[0]==70&&x[1]==79&&x[2]==82&&x[3]==77){var o=String.fromCharCode(x[8],x[9],x[10],x[11]);if(o=="IFZS"){u.io.fatal_error("This is a saved-game file, not a "+u.game_format_name+" game file. You must launch the game first, then restore your save.");return}if(o!="IFRS"){u.io.fatal_error("This IFF file is not a Blorb file!");return}if(u.blorb_gamechunk_type){if(!u.Blorb){u.io.fatal_error("Blorb file could not be parsed because no BlorbClass is available.");return}try{var A={exec:!0,pict:!0,data:!0};u.retainuses!==void 0&&(A=u.retainuses),u.Blorb.init(x,{format:"blorbbytes",retainuses:A}),x=u.Blorb.get_exec_data(u.blorb_gamechunk_type)}catch(v){u.io.fatal_error("Blorb file could not be parsed: "+v);return}}if(!x){u.io.fatal_error("Blorb file contains no "+u.game_format_name+" game!");return}}u.Blorb&&!u.Blorb.inited()&&(u.image_info_map?u.Blorb.init(u.image_info_map,{format:"infomap"}):u.resources?u.Blorb.init(u.resource_array):u.Blorb.init([]));{var H=null;u.Blorb&&(H=u.Blorb.get_metadata("title")),!H&&D&&(H=D.slice(D.lastIndexOf("/")+1)),H||(H=u.default_page_title),H||(H="Game"),u.recording_label||(u.recording_label=H),u.set_page_title&&(document.title=H+" - "+u.engine_name)}let n=Array.from(x);u.vm.init(n,u),pe=!0,u.io.init(u)}function Z(){return pe}function de(x){switch(x){case"GlkOte":return ne;case"GiDispa":return u.GiDispa;case"Blorb":return u.Blorb;case"VM":return u.vm;case"IO":return u.io}return null}return{classname:"GiLoad",load_run:be,inited:Z,getlibrary:de}},bs=new Mf;try{Zr.GiLoad=bs,Zr.GiLoadClass=Mf}catch{}});var Cf=Or(yf(),1),Sf=Or(xf(),1),Gf=Or(Lf(),1);window.Quixe=Cf.default.Quixe;window.GiDispa=Sf.default.GiDispaClass;window.GiLoad=Gf.default.GiLoad;})();
